

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Introduction à zc.buildout &mdash; Plone pour les intégrateurs 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Recherchez dans Plone pour les intégrateurs 1.0.0 documentation"
          href="_static/opensearch.xml"/>
    <link rel="top" title="Plone pour les intégrateurs 1.0.0 documentation" href="index.html" />
    <link rel="next" title="Installation et création d’une instance Plone" href="installation_et_creation_d_une_instance_Plone.html" />
    <link rel="prev" title="Concept de Python eggs" href="concepts_python_eggs.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="installation_et_creation_d_une_instance_Plone.html" title="Installation et création d’une instance Plone"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="concepts_python_eggs.html" title="Concept de Python eggs"
             accesskey="P">précédent</a> |</li>
        <li><a href="index.html">Formation Plone</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="introduction-a-zc-buildout">
<span id="introduction-zc-buildout"></span><h1>Introduction à zc.buildout<a class="headerlink" href="#introduction-a-zc-buildout" title="Lien permanent vers ce titre">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Vincent Fretin</td>
</tr>
<tr class="field-even field"><th class="field-name">Contributors:</th><td class="field-body"></td>
</tr>
<tr class="field-odd field"><th class="field-name">Révision:</th><td class="field-body"><a class="reference external" href="https://svn.plone.org/svn/collective/collective.trainingmanual/trunk/fr/integrateur/source/presentation_buildout.txt">https://svn.plone.org/svn/collective/collective.trainingmanual/trunk/fr/integrateur/source/presentation_buildout.txt</a></td>
</tr>
</tbody>
</table>
<p>Copyright (C) 2010 Vincent Fretin &lt;vincentfretin AT gmail.com&gt;.</p>
<p>Chacun est autorisé à copier, distribuer et/ou modifier ce document
suivant les termes de la licence Paternité-Pas
d&#8217;Utilisation Commerciale-Partage des Conditions Initiales à l&#8217;Identique 2.0
France accessible à <a class="reference external" href="http://creativecommons.org/licenses/by-nc-sa/2.0/fr">http://creativecommons.org/licenses/by-nc-sa/2.0/fr</a></p>
<p>Le code source présent dans ce document est soumis aux conditions de
la « Zope Public License », Version 2.1 (ZPL).</p>
<p>THE SOURCE CODE IN THIS DOCUMENT AND THE DOCUMENT ITSELF IS PROVIDED
&#8220;AS IS&#8221; AND ANY AND ALL EXPRESS OR IMPLIED WARRANTIES ARE DISCLAIMED,
INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF TITLE,
MERCHANTABILITY, AGAINST INFRINGEMENT, AND FITNESS FOR A PARTICULAR
PURPOSE.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#definition" id="id1">Définition</a></li>
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li>
<li><a class="reference internal" href="#organisation-d-un-buildout" id="id3">Organisation d&#8217;un buildout</a></li>
<li><a class="reference internal" href="#section-principale-buildout" id="id4">Section principale [buildout]</a></li>
<li><a class="reference internal" href="#partage-du-dossier-eggs-et-downloads" id="id5">Partage du dossier eggs et downloads</a></li>
<li><a class="reference internal" href="#pinning-des-versions" id="id6">Pinning des versions</a></li>
<li><a class="reference internal" href="#extension-buildout-dumppickedversions" id="id7">Extension buildout.dumppickedversions</a></li>
<li><a class="reference internal" href="#option-extends" id="id8">Option extends</a><ul>
<li><a class="reference internal" href="#option-extends-cache" id="id9">Option extends-cache</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recipe-collective-recipe-omelette" id="id10">Recipe collective.recipe.omelette</a></li>
<li><a class="reference internal" href="#utilisation-de-variable" id="id11">Utilisation de variable</a></li>
<li><a class="reference internal" href="#repinning-et-fusion-de-section-de-donnees" id="id12">Repinning et fusion de section de données</a></li>
<li><a class="reference internal" href="#ordre-d-installation-des-parts" id="id13">Ordre d&#8217;installation des parts</a></li>
<li><a class="reference internal" href="#l-option-develop" id="id14">L&#8217;option develop</a></li>
<li><a class="reference internal" href="#option-index-et-find-links" id="id15">Option index et find-links</a></li>
</ul>
</div>
<div class="section" id="definition">
<h2><a class="toc-backref" href="#id1">Définition</a><a class="headerlink" href="#definition" title="Lien permanent vers ce titre">¶</a></h2>
<p>Un <a class="reference internal" href="glossaire.html#term-buildout"><em class="xref std std-term">buildout</em></a> est un dossier contenant plusieurs fichiers de configuration
permettant de reproduire à l&#8217;identique un environnement de développement ou de
production. <cite>Paster</cite> est l&#8217;outil qui permet de générer le code squelette pour
démarrer.</p>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id2">Introduction</a><a class="headerlink" href="#introduction" title="Lien permanent vers ce titre">¶</a></h2>
<p>Buildout est un système d&#8217;installation permettant d&#8217;obtenir le même résultat d&#8217;une machine à l&#8217;autre. L&#8217;installation est reproductible.</p>
<ul class="simple">
<li><a class="reference external" href="http://ccomb.gorfou.fr/2007/12/13/tutoriel-sur-buildout#qu-est-ce-que-zc-buildout">Qu&#8217;est-ce que zc.buildout ?</a></li>
<li><a class="reference external" href="http://ccomb.gorfou.fr/2007/12/13/tutoriel-sur-buildout#survol-de-buildout">Survol de Buildout</a></li>
</ul>
<p><a class="reference internal" href="glossaire.html#term-zc-buildout"><em class="xref std std-term">zc.buildout</em></a> permet d&#8217;avoir un environnement (pas forcément isolé), mais
d&#8217;une autre manière que <cite>virtualenv</cite>.</p>
<p>Une configuration buildout spécifie un ensemble de parts qui se composent :</p>
<ul class="simple">
<li>d&#8217;une recette (recipe)</li>
<li>et/ou de données de configuration</li>
</ul>
</div>
<div class="section" id="organisation-d-un-buildout">
<h2><a class="toc-backref" href="#id3">Organisation d&#8217;un buildout</a><a class="headerlink" href="#organisation-d-un-buildout" title="Lien permanent vers ce titre">¶</a></h2>
<p>Un buildout est organisé de la manière suivante :</p>
<ul class="simple">
<li><tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt> : contient la configuration du buildout</li>
<li><tt class="file docutils literal"><span class="pre">bootstrap.py</span></tt> : script d&#8217;amorçage de buildout utilisé la première fois</li>
<li><tt class="file docutils literal"><span class="pre">bin/</span></tt> : dossier contenant les exécutables éventuellement générés par
les parts</li>
<li><tt class="file docutils literal"><span class="pre">src/</span></tt> : par convention, dossier où sont placés les eggs en
développement</li>
<li><tt class="file docutils literal"><span class="pre">parts/</span></tt> : dossier où sont stockées les données générées des parts si
besoin</li>
<li><tt class="file docutils literal"><span class="pre">.installed.cfg</span></tt> : fichier caché mémorisant l&#8217;état du buildout</li>
<li><tt class="file docutils literal"><span class="pre">.mr.developer.cfg</span></tt> : fichier caché mémorisant l&#8217;état des packages en
développement si vous utilisez l&#8217;extension <em>mr.developer</em>.</li>
<li><tt class="file docutils literal"><span class="pre">eggs/</span></tt> : dossier contenant les eggs activés ou non. Peut ne pas exister
si on utilise un dossier partagé pour plusieurs buildouts.</li>
<li><tt class="file docutils literal"><span class="pre">develop-eggs/</span></tt> : dossier contenant les liens vers les eggs en
développement</li>
<li><tt class="file docutils literal"><span class="pre">extends-cache/</span></tt> si vous mettez en cache les fichiers de versions téléchargés.</li>
</ul>
<p>Seuls les fichiers <tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt>, <tt class="file docutils literal"><span class="pre">bootstrap.py</span></tt> et <tt class="file docutils literal"><span class="pre">extends-cache/</span></tt>
ont besoin d&#8217;être mis dans une gestionnaire de versions.</p>
<p>Nous allons prendre comme exemple le <tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt> pour installer
archgenxml.</p>
<p>Suivez la <a class="reference external" href="http://plone.org/documentation/manual/archgenxml2/startup/installation">page d&#8217;installation du manuel d&#8217;archgenxml2</a></p>
<p>Créez un dossier <tt class="file docutils literal"><span class="pre">archgenxml_buildout/</span></tt>, placez y une copie du fichier <a class="reference external" href="http://svn.zope.org/*checkout*/zc.buildout/trunk/bootstrap/bootstrap.py">bootstrap.py</a>
et créez un fichier <tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt> avec le contenu suivant :</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="k">[buildout]</span>
<span class="na">parts</span> <span class="o">=</span><span class="s"></span>
<span class="s">    archgenxml</span>

<span class="k">[archgenxml]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">zc.recipe.egg:scripts</span>
<span class="na">eggs</span> <span class="o">=</span> <span class="s">archgenxml</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Les versions de <em>zc.buildout</em> &gt;= 1.5.2 permettent d&#8217;avoir un environnement
isolé du système, cela est désactivé par défaut pour garder la
compatibilité avec les versions antérieures. Pour avoir pleinement
cette fonctionnalité, il faut que vous activiez l&#8217;option <tt class="docutils literal"><span class="pre">include-site-packages</span> <span class="pre">=</span> <span class="pre">false</span></tt>
et que vous remplaciez <em>zc.recipe.egg</em> par <em>z3c.recipe.scripts</em>. Si vous
utilisez d&#8217;autres recipes, il faut qu&#8217;elles utilisent aussi
<em>z3c.recipe.scripts</em> en interne. Regardez dans le changelog de ces recipes,
s&#8217;il est indiqué que la recipe dépend maintenant d&#8217;une version &gt;= 1.5.0, c&#8217;est
qu&#8217;elle a dû être adapté pour utiliser <em>z3c.recipe.scripts</em>.</p>
</div>
</div>
<div class="section" id="section-principale-buildout">
<h2><a class="toc-backref" href="#id4">Section principale [buildout]</a><a class="headerlink" href="#section-principale-buildout" title="Lien permanent vers ce titre">¶</a></h2>
<p>La variable <tt class="xref py py-data docutils literal"><span class="pre">parts</span></tt> contient la liste des parts que buildout doit
installer. La convention est de mettre une <a class="reference internal" href="glossaire.html#term-part"><em class="xref std std-term">part</em></a> par ligne, indenté de 4
espaces. Il peut y avoir des lignes vides et des commentaires commencant au début de la ligne.</p>
<p>Chaque <em>part</em> fournit une variable <tt class="xref py py-data docutils literal"><span class="pre">recipe</span></tt> pour indiquer comment ce <em>part</em>
doit être installé, mis à jour et supprimé.</p>
<p>Il se peut qu&#8217;une section ne fournisse pas de <em>recipe</em>. Elle sert généralement
pour des données de configuration que d&#8217;autres <em>parts</em> utiliseront.</p>
<p>Amorcez le buildout (choisissez bien la version de l&#8217;exécutable python) :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>python bootstrap.py -d
Downloading http://pypi.python.org/packages/source/d/distribute/distribute-0.6.14.tar.gz
...
Creating directory <span class="s1">&#39;/home/vincentfretin/archgenxml_buildout/bin&#39;</span>.
Creating directory <span class="s1">&#39;/home/vincentfretin/archgenxml_buildout/parts&#39;</span>.
Creating directory <span class="s1">&#39;/home/vincentfretin/archgenxml_buildout/eggs&#39;</span>.
Creating directory <span class="s1">&#39;/home/vincentfretin/archgenxml_buildout/develop-eggs&#39;</span>.
Generated script <span class="s1">&#39;/home/vincentfretin/archgenxml_buildout/bin/buildout&#39;</span>.
<span class="nv">$ </span>tree
.
|-- bin
|   <span class="sb">`</span>-- buildout
|-- bootstrap.py
|-- buildout.cfg
|-- develop-eggs
|-- eggs
|   |-- distribute-0.6.28-py2.7.egg
|   <span class="sb">`</span>-- zc.buildout-1.5.2-py2.7.egg
<span class="sb">`</span>-- parts
    <span class="sb">`</span>-- buildout
</pre></div>
</div>
<p>L&#8217;amorçage (ou bootstrapping) installe <tt class="xref py py-mod docutils literal"><span class="pre">distribute</span></tt> et <tt class="xref py py-mod docutils literal"><span class="pre">zc.buildout</span></tt>.
L&#8217;amorçage génère le script <tt class="file docutils literal"><span class="pre">bin/buildout</span></tt>.</p>
<p>Exécutez maintenant :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>bin/buildout
Getting distribution <span class="k">for</span> <span class="s1">&#39;zc.recipe.egg&#39;</span>.
Got zc.recipe.egg 1.3.2.
Installing archgenxml.
Getting distribution <span class="k">for</span> <span class="s1">&#39;archgenxml&#39;</span>.
Got archgenxml 2.6.
...
Generated script <span class="s1">&#39;/home/vincentfretin/archgenxml_buildout/bin/archgenxml&#39;</span>.
Generated script <span class="s1">&#39;/home/vincentfretin/archgenxml_buildout/bin/agx_argouml_profile&#39;</span>.
Generated script <span class="s1">&#39;/home/vincentfretin/archgenxml_buildout/bin/agx_stereotypes&#39;</span>.
Generated script <span class="s1">&#39;/home/vincentfretin/archgenxml_buildout/bin/agx_taggedvalues&#39;</span>.
</pre></div>
</div>
<p>Le egg <tt class="xref py py-mod docutils literal"><span class="pre">archgenxml</span></tt> et ses dépendances sont téléchargés et installés et
divers scripts sont générés à la fin. C&#8217;est la recipe qui dit tout ça.</p>
<p>À première vue, l&#8217;exécution de buildout pourrait se résumer à cet algorithme :
pour chaque part de l&#8217;option parts de la section <tt class="docutils literal"><span class="pre">[buildout]</span></tt>, appeler la
<a class="reference internal" href="glossaire.html#term-recipe"><em class="xref std std-term">recipe</em></a> associée au part.</p>
<p>Revenons à la ligne <tt class="docutils literal"><span class="pre">recipe</span> <span class="pre">=</span> <span class="pre">zc.recipe.egg:scripts</span></tt>. <tt class="xref py py-mod docutils literal"><span class="pre">zc.recipe.egg</span></tt> est
un <a class="reference internal" href="glossaire.html#term-egg"><em class="xref std std-term">egg</em></a> à deux espaces de nom et le <tt class="docutils literal"><span class="pre">scripts</span></tt> après les deux points est un
entry point du groupe <tt class="xref py py-mod docutils literal"><span class="pre">zc.buildout</span></tt>.</p>
<p>Si vous ne spécifiez pas de point d&#8217;entrée, un point d&#8217;entrée nommé <tt class="docutils literal"><span class="pre">default</span></tt>
sera alors recherché dans l&#8217;egg.</p>
<p>Jetez un œil au <tt class="file docutils literal"><span class="pre">setup.py</span></tt> de zc.recipe.egg :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">entry_points</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;zc.buildout&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;default = </span><span class="si">%s</span><span class="s">:Scripts&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                                <span class="s">&#39;script = </span><span class="si">%s</span><span class="s">:Scripts&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                                <span class="s">&#39;scripts = </span><span class="si">%s</span><span class="s">:Scripts&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                                <span class="s">&#39;eggs = </span><span class="si">%s</span><span class="s">:Eggs&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                                <span class="s">&#39;custom = </span><span class="si">%s</span><span class="s">:Custom&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                                <span class="s">&#39;develop = </span><span class="si">%s</span><span class="s">:Develop&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                                <span class="p">]</span>
                <span class="p">},</span>
</pre></div>
</div>
<p>Dans ce cas, nous serions arrivé au même résultat si nous avions mis l&#8217;une de
ces lignes :</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="na">recipe</span> <span class="o">=</span> <span class="s">zc.recipe.egg</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">zc.recipe.egg:default</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">zc.recipe.egg:scripts</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">zc.recipe.egg:script</span>
</pre></div>
</div>
<p>L&#8217;entry point <tt class="docutils literal"><span class="pre">scripts</span></tt> pointe vers la classe <tt class="xref py py-class docutils literal"><span class="pre">Scripts</span></tt> du package
<tt class="xref py py-mod docutils literal"><span class="pre">zc.recipe.egg</span></tt>.</p>
<p>Cette classe, comme toute recipe, contient des méthodes install et update. Voir
l&#8217;<a class="reference external" href="http://ccomb.gorfou.fr/2007/12/13/tutoriel-sur-buildout#criture-de-recettes">API des recettes</a></p>
<p>Le fichier caché <tt class="file docutils literal"><span class="pre">.installed.cfg</span></tt> garde la configuration de la dernière
exécution de <a class="reference internal" href="glossaire.html#term-buildout"><em class="xref std std-term">buildout</em></a>.</p>
<p>Lorsqu&#8217;une section a été supprimée de la configuration, cette partie sera
désinstallée lors de la relance de <strong class="command">bin/buildout</strong>. Si une section a
été mise à jour, cette partie sera réinstallée. Pour les nouvelles sections avec
<a class="reference internal" href="glossaire.html#term-recipe"><em class="xref std std-term">recipe</em></a>, les parties seront installées.</p>
<p>Notre algorithme de tout à l&#8217;heure est maintenant :</p>
<ul class="simple">
<li>pour chaque part de l&#8217;option <tt class="docutils literal"><span class="pre">parts</span></tt> de la section <tt class="docutils literal"><span class="pre">[buildout]</span></tt> :<ul>
<li>installer la recipe du <a class="reference internal" href="glossaire.html#term-part"><em class="xref std std-term">part</em></a> ;</li>
<li>récupérer l&#8217;entry point spécifié (<tt class="docutils literal"><span class="pre">default</span></tt> si non spécifié) depuis la
<a class="reference internal" href="glossaire.html#term-recipe"><em class="xref std std-term">recipe</em></a> ;</li>
<li>si le <a class="reference internal" href="glossaire.html#term-part"><em class="xref std std-term">part</em></a> est actuellement installé mais sa configuration a changé,
appeler la méthode <tt class="xref py py-meth docutils literal"><span class="pre">update()</span></tt> de l&#8217;entry point ;</li>
<li>si le <a class="reference internal" href="glossaire.html#term-part"><em class="xref std std-term">part</em></a> n&#8217;a pas encore été installé, appeler la méthode <tt class="xref py py-meth docutils literal"><span class="pre">install()</span></tt>
de l&#8217;entry point ;</li>
<li>si un part existe dans <tt class="file docutils literal"><span class="pre">.installed.cfg</span></tt> et n&#8217;est plus dans la liste des parts
de <tt class="docutils literal"><span class="pre">[buildout]</span></tt>, alors le part est désintallé.</li>
</ul>
</li>
</ul>
<p>Jetez un œil sur les scripts générés. Rappel : les scripts <tt class="file docutils literal"><span class="pre">bin/archgenxml</span></tt>
et <tt class="file docutils literal"><span class="pre">bin/agx_*</span></tt> sont générés car le <a class="reference internal" href="glossaire.html#term-egg"><em class="xref std std-term">egg</em></a> <tt class="xref py py-mod docutils literal"><span class="pre">archgenxml</span></tt> a des
entry points dans le groupe <tt class="docutils literal"><span class="pre">console_scripts</span></tt>.  :</p>
<p class="centered">
<strong><tt class="file docutils literal"><span class="pre">bin/archgenxml</span></tt></strong></p><div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/python</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s">&#39;/home/vincentfretin/archgenxml_buildout/eggs/archgenxml-2.6-py2.7.egg&#39;</span><span class="p">,</span>
  <span class="o">...</span>
  <span class="p">]</span>

<span class="kn">import</span> <span class="nn">archgenxml.ArchGenXML</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">archgenxml</span><span class="o">.</span><span class="n">ArchGenXML</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>La première ligne est le shebang, la version du python avec laquelle vous avez
fait command:<cite>python bootstrap.py -d</cite> au début. <tt class="xref py py-mod docutils literal"><span class="pre">archgenxml</span></tt> et toutes ses
dépendances sont ajoutés au début du <tt class="xref py py-data docutils literal"><span class="pre">sys.path</span></tt>.</p>
</div>
<div class="section" id="partage-du-dossier-eggs-et-downloads">
<h2><a class="toc-backref" href="#id5">Partage du dossier eggs et downloads</a><a class="headerlink" href="#partage-du-dossier-eggs-et-downloads" title="Lien permanent vers ce titre">¶</a></h2>
<p>Lors de l&#8217;exécution de buildout, le fichier <tt class="file docutils literal"><span class="pre">~/.buildout/default.cfg</span></tt> est
lu, c&#8217;est dans ce fichier que nous pouvons mettre des options qui seront
partagées par tous nos buildouts.</p>
<p>Si le dossier <tt class="file docutils literal"><span class="pre">~/.buildout/</span></tt> n&#8217;existe pas, créez le ainsi que les
sous-dossiers :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>mkdir ~/.buildout ~/.buildout/eggs ~/.buildout/downloads <span class="se">\</span>
  ~/.buildout/configs ~/.buildout/zope
</pre></div>
</div>
<p>Créez le fichier <tt class="file docutils literal"><span class="pre">~/.buildout/default.cfg</span></tt> avec ce contenu :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">[</span>buildout<span class="o">]</span>
eggs-directory <span class="o">=</span> /home/vincentfretin/.buildout/eggs
download-cache <span class="o">=</span> /home/vincentfretin/.buildout/downloads
<span class="c">#extends-cache = /home/vincentfretin/.buildout/configs</span>
zope-directory <span class="o">=</span> /home/vincentfretin/.buildout/zope
</pre></div>
</div>
<p>Remplacez ici bien sûr <tt class="docutils literal"><span class="pre">vincentfretin</span></tt> par votre compte. Vous ne pouvez pas
utiliser le caractère <em>~</em> ici.</p>
<p>L&#8217;option <tt class="xref py py-data docutils literal"><span class="pre">zope-directory</span></tt> permet de partager la même installation de
Zope 2.10.x pour plusieurs buildouts Plone 3.3.x.</p>
<p>À savoir que les valeurs par défaut de ces variables sont :</p>
<div class="highlight-python"><pre>eggs-directory = ${buildout:directory}/eggs
download-cache = pas précisé, on ne garde pas les archives par défaut
extends-cache = pas de cache par défaut</pre>
</div>
<p><tt class="docutils literal"><span class="pre">${buildout:directory}</span></tt> étant le dossier du buildout. C&#8217;est pour cela que le
dossier <tt class="docutils literal"><span class="pre">eggs</span></tt> était créé dans le buildout.</p>
<p>Vous pouvez supprimer le dossier <tt class="file docutils literal"><span class="pre">eggs</span></tt> de votre buildout, le réamorcer
et reexécuter <strong class="command">bin/buildout</strong></p>
</div>
<div class="section" id="pinning-des-versions">
<h2><a class="toc-backref" href="#id6">Pinning des versions</a><a class="headerlink" href="#pinning-des-versions" title="Lien permanent vers ce titre">¶</a></h2>
<p>À chaque fois que vous exécutez <strong class="command">bin/buildout</strong>, une requête est faite
au serveur central pour savoir si nous avons la dernière version du <a class="reference internal" href="glossaire.html#term-egg"><em class="xref std std-term">egg</em></a>.
C&#8217;est le comportement par défaut. En effet nous avons l&#8217;option <tt class="docutils literal"><span class="pre">newest</span> <span class="pre">=</span> <span class="pre">true</span></tt>
dans la section <tt class="docutils literal"><span class="pre">[buildout]</span></tt> par défaut.</p>
<p>Vous pouvez faire <strong class="command">bin/buildout -N</strong> pour ne pas vérifier les mises à
jour.</p>
<p>Si vous aviez <tt class="docutils literal"><span class="pre">newest</span> <span class="pre">=</span> <span class="pre">false</span></tt> dans votre buildout, la commande
<strong class="command">bin/buildout -n</strong> la remettrait à <tt class="docutils literal"><span class="pre">true</span></tt> pour l&#8217;exécution.</p>
<p>Le problème est que votre <a class="reference internal" href="glossaire.html#term-buildout"><em class="xref std std-term">buildout</em></a> n&#8217;est pas reproductible à
l&#8217;identique. Pour qu&#8217;il soit reproductible à l&#8217;identique il faudrait que
votre buildout précise quelles versions des eggs doivent être installées.</p>
<p>C&#8217;est là qu&#8217;intervient l&#8217;option <tt class="docutils literal"><span class="pre">versions</span></tt> de la section <tt class="docutils literal"><span class="pre">[buildout]</span></tt>, vous
spécifiez dans quelle section vous avez les informations sur les versions. La
convention est de l&#8217;appeler également <tt class="docutils literal"><span class="pre">versions</span></tt>. Pour geler (verbe &#8220;to pin&#8221;
en anglais, &#8220;pinned&#8221; au participe passé) archgenxml, modifiez votre
buildout de cette manière :</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="k">[buildout]</span>
<span class="na">versions</span> <span class="o">=</span> <span class="s">versions</span>
<span class="na">parts</span> <span class="o">=</span> <span class="s">archgenxml</span>

<span class="k">[versions]</span>
<span class="na">archgenxml</span> <span class="o">=</span> <span class="s">2.6</span>
<span class="c1"># ...</span>

<span class="k">[archgenxml]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">zc.recipe.egg:scripts</span>
<span class="na">eggs</span> <span class="o">=</span> <span class="s">archgenxml</span>
</pre></div>
</div>
<p>Mais cela ne suffit pas pour que le buildout soit reproductible car nous n&#8217;avons
pas gelé les dépendances d&#8217;archgenxml.</p>
</div>
<div class="section" id="extension-buildout-dumppickedversions">
<h2><a class="toc-backref" href="#id7">Extension buildout.dumppickedversions</a><a class="headerlink" href="#extension-buildout-dumppickedversions" title="Lien permanent vers ce titre">¶</a></h2>
<p><tt class="xref py py-mod docutils literal"><span class="pre">zc.buildout</span></tt> peut être étendu avec des extensions. Il y en a une
particulièrement intéressante qui va vous sortir la liste des eggs qui ne sont
pas gelés avec leur version.</p>
<p>Une extension s&#8217;ajoute avec l&#8217;option <tt class="docutils literal"><span class="pre">extensions</span></tt> de la section <tt class="docutils literal"><span class="pre">[buildout]</span></tt>
Ajoutez donc l&#8217;extension <tt class="xref py py-mod docutils literal"><span class="pre">buildout.dumppickedversions</span></tt> à votre fichier
<tt class="file docutils literal"><span class="pre">~/.buildout/default.cfg</span></tt>, comme cela l&#8217;extension sera active pour tous
vos buildouts :</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="k">[buildout]</span>
<span class="na">extensions</span> <span class="o">=</span> <span class="s">buildout.dumppickedversions</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>Relancez <strong class="command">bin/buildout</strong> et à la fin de l&#8217;exécution vous verrez
apparaitre la liste des versions à geler. Ajoutez-les tous à votre section
versions, et reexécutez <strong class="command">bin/buildout</strong>, il ne devrait plus avoir de
versions.</p>
<p>Il existe aussi une option <tt class="docutils literal"><span class="pre">allow-picked-versions</span> <span class="pre">=</span> <span class="pre">false</span></tt> disponible dans le
cœur de <tt class="xref py py-mod docutils literal"><span class="pre">zc.buildout</span></tt> qui permet de stopper le buildout si un egg n&#8217;est pas
gelé. Cette option et l&#8217;extension <tt class="xref py py-mod docutils literal"><span class="pre">buildout.dumppickedversions</span></tt> sont
mutuellement exclusives.</p>
</div>
<div class="section" id="option-extends">
<h2><a class="toc-backref" href="#id8">Option extends</a><a class="headerlink" href="#option-extends" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il est possible d&#8217;étendre le fichier buildout.cfg.
Vous verrez souvent un fichier <tt class="file docutils literal"><span class="pre">deployment.cfg</span></tt> ou <tt class="file docutils literal"><span class="pre">development.cfg</span></tt> qui étend le fichier <tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt> de base.</p>
<p>Créez un fichier <tt class="file docutils literal"><span class="pre">development.cfg</span></tt> :</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="k">[buildout]</span>
<span class="na">extends</span> <span class="o">=</span> <span class="s">buildout.cfg</span>
<span class="na">parts</span> <span class="o">=</span> <span class="s">omelette</span>

<span class="k">[omelette]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">collective.recipe.omelette</span>
<span class="na">eggs</span> <span class="o">=</span> <span class="s">archgenxml</span>
</pre></div>
</div>
<p>L&#8217;option <tt class="docutils literal"><span class="pre">extends</span></tt> dit de lire le fichier <tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt>, et les options
que l&#8217;on spécifiera par la suite seront écrasées.</p>
<p>Par défaut, buildout cherche un fichier <tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt>, l&#8217;option
<em class="xref std std-option">-c</em> permet d&#8217;indiquer un fichier alternatif.</p>
<p>Relancez la machinerie buildout avec ce fichier :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>bin/buildout -c development.cfg
Uninstalling archgenxml.
Installing omelette.
</pre></div>
</div>
<p>Oh que s&#8217;est-il passé ? Vous avez écrasé l&#8217;option <tt class="xref py py-data docutils literal"><span class="pre">parts</span></tt>, il n&#8217;y a donc
plus que le part <tt class="xref py py-data docutils literal"><span class="pre">omelette</span></tt> à installer.</p>
<p>Vous vouliez garder aussi le part <tt class="xref py py-data docutils literal"><span class="pre">archgenxml</span></tt>, rectifiez ça en
transformant le <tt class="docutils literal"><span class="pre">=</span></tt> par <tt class="docutils literal"><span class="pre">+=</span></tt>, ce qui donne <tt class="docutils literal"><span class="pre">parts</span> <span class="pre">+=</span> <span class="pre">omelette</span></tt>.</p>
<p>Toutes les options supportant une liste fonctionnent ainsi (<tt class="docutils literal"><span class="pre">parts</span></tt>, <tt class="docutils literal"><span class="pre">eggs</span></tt>,
<tt class="docutils literal"><span class="pre">develop</span></tt>).</p>
<p>Relancez buildout. Là les deux parts sont bien installées.</p>
<div class="admonition-remarque admonition">
<p class="first admonition-title">Remarque</p>
<p class="last">imaginez toujours que vous avez implicitement <tt class="docutils literal"><span class="pre">extends</span> <span class="pre">=</span>
<span class="pre">~/.buildout/default.cfg</span></tt> dans votre <tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt> de base, à partir
duquel vous étendez d&#8217;autres configurations, ici c&#8217;est le fichier
<tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt>.</p>
</div>
<p>Vous pouvez récupérer une version mis à plat de la configuration avec
la commande suivante :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>bin/buildout -c development.cfg annotate
...
<span class="o">[</span>buildout<span class="o">]</span>
<span class="nv">parts</span><span class="o">=</span>
archgenxml
omelette
    /home/vincentfretin/archgenxml_buildout/buildout.cfg
+<span class="o">=</span>  /home/vincentfretin/archgenxml_buildout/development.cfg
...
</pre></div>
</div>
<p>Vous voyez bien ici que l&#8217;option <em>parts</em> a été mis à plat,
c&#8217;est la concaténation de l&#8217;option trouvée dans <tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt>
et de <tt class="file docutils literal"><span class="pre">development.cfg</span></tt>.</p>
<div class="section" id="option-extends-cache">
<h3><a class="toc-backref" href="#id9">Option extends-cache</a><a class="headerlink" href="#option-extends-cache" title="Lien permanent vers ce titre">¶</a></h3>
<p>L&#8217;option <tt class="xref py py-data docutils literal"><span class="pre">extends-cache</span></tt> disponible depuis la version 1.4.0 de
<tt class="xref py py-mod docutils literal"><span class="pre">zc.buildout</span></tt> permet de mettre en cache les fichiers référencés dans
l&#8217;option <tt class="xref py py-data docutils literal"><span class="pre">extends</span></tt>.</p>
<p>Prenons l&#8217;exemple suivant :</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="na">extends</span> <span class="o">=</span> <span class="s">http://dist.plone.org/release/4.2/versions.cfg</span>
</pre></div>
</div>
<p>Le fichier <tt class="file docutils literal"><span class="pre">versions.cfg</span></tt> sera mis en cache dans le dossier <tt class="file docutils literal"><span class="pre">~/.buildout/configs/</span></tt>, le fichier créé étant la somme md5 de l&#8217;url.</p>
<p>Une fois mis en cache, il est possible de relancer le buildout en mode hors
ligne avec la commande <strong class="command">bin/buildout -o</strong>.</p>
</div>
</div>
<div class="section" id="recipe-collective-recipe-omelette">
<h2><a class="toc-backref" href="#id10">Recipe collective.recipe.omelette</a><a class="headerlink" href="#recipe-collective-recipe-omelette" title="Lien permanent vers ce titre">¶</a></h2>
<p>On ne fait pas d&#8217;omelette sans casser des eggs. Cette <em>recipe</em> permet de mettre à
plat les eggs :</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="k">[omelette]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">collective.recipe.omelette</span>
<span class="na">eggs</span> <span class="o">=</span> <span class="s">archgenxml</span>
</pre></div>
</div>
<p>Cette recipe génère une arborescence dans <tt class="file docutils literal"><span class="pre">parts/omelette/</span></tt> contenant archgenxml
et toutes ses dépendances directes ou indirectes :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>tree parts/omelette/
parts/omelette
|-- archgenxml -&gt; /home/vincentfretin/.buildout/eggs/archgenxml-2.5-py2.6.egg/archgenxml
|-- easy_install.py -&gt; /usr/local/lib/python2.6/dist-packages/distribute-0.6.14-py2.6.egg/easy_install.py
|-- i18ndude -&gt; /home/vincentfretin/.buildout/eggs/i18ndude-3.2-py2.6.egg/i18ndude
|-- pkg_resources.py -&gt; /usr/local/lib/python2.6/dist-packages/distribute-0.6.14-py2.6.egg/pkg_resources.py
|-- plone
|   |-- __init__.py
|   <span class="sb">`</span>-- i18n -&gt; /home/vincentfretin/.buildout/eggs/plone.i18n-2.0-py2.6.egg/plone/i18n
|-- setuptools -&gt; /usr/local/lib/python2.6/dist-packages/distribute-0.6.14-py2.6.egg/setuptools
|-- site.py -&gt; /usr/local/lib/python2.6/dist-packages/distribute-0.6.14-py2.6.egg/site.py
|-- stripogram -&gt; /home/vincentfretin/.buildout/eggs/stripogram-1.5-py2.6.egg/stripogram
|-- xmiparser -&gt; /home/vincentfretin/.buildout/eggs/xmiparser-1.5-py2.6.egg/xmiparser
<span class="sb">`</span>-- zope
    |-- __init__.py
    |-- browser -&gt; /home/vincentfretin/.buildout/eggs/zope.browser-1.3-py2.6.egg/zope/browser
    |-- component -&gt; /home/vincentfretin/.buildout/eggs/zope.component-3.10.0-py2.6.egg/zope/component
    |-- configuration -&gt; /home/vincentfretin/.buildout/eggs/zope.configuration-3.7.2-py2.6.egg/zope/configuration
    |-- contenttype -&gt; /home/vincentfretin/.buildout/eggs/zope.contenttype-3.5.1-py2.6.egg/zope/contenttype
    |-- documenttemplate -&gt; /home/vincentfretin/.buildout/eggs/zope.documenttemplate-3.4.2-py2.6.egg/zope/documenttemplate
    |-- event -&gt; /home/vincentfretin/.buildout/eggs/zope.event-3.5.0_1-py2.6.egg/zope/event
    |-- exceptions -&gt; /home/vincentfretin/.buildout/eggs/zope.exceptions-3.6.1-py2.6.egg/zope/exceptions
    |-- i18n -&gt; /home/vincentfretin/.buildout/eggs/zope.i18n-3.7.4-py2.6.egg/zope/i18n
    |-- i18nmessageid -&gt; /home/vincentfretin/.buildout/eggs/zope.i18nmessageid-3.5.3-py2.6-linux-x86_64.egg/zope/i18nmessageid
    |-- interface -&gt; /home/vincentfretin/.buildout/eggs/zope.interface-3.6.1-py2.6-linux-x86_64.egg/zope/interface
    |-- location -&gt; /home/vincentfretin/.buildout/eggs/zope.location-3.9.0-py2.6.egg/zope/location
    |-- proxy -&gt; /home/vincentfretin/.buildout/eggs/zope.proxy-3.6.1-py2.6-linux-x86_64.egg/zope/proxy
    |-- publisher -&gt; /home/vincentfretin/.buildout/eggs/zope.publisher-3.12.4-py2.6.egg/zope/publisher
    |-- schema -&gt; /home/vincentfretin/.buildout/eggs/zope.schema-3.7.0-py2.6.egg/zope/schema
    |-- security -&gt; /home/vincentfretin/.buildout/eggs/zope.security-3.7.4-py2.6-linux-x86_64.egg/zope/security
    |-- structuredtext -&gt; /home/vincentfretin/.buildout/eggs/zope.structuredtext-3.5.0-py2.6.egg/zope/structuredtext
    <span class="sb">`</span>-- tal -&gt; /home/vincentfretin/.buildout/eggs/zope.tal-3.5.2-py2.6.egg/zope/tal

25 directories, 5 files
</pre></div>
</div>
<p>Cela permet d&#8217;avoir les packages à plat, ce qui facilite la recherche, exemple :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>find -L parts/omelette -name <span class="s2">&quot;interfaces.py&quot;</span>
<span class="nv">$ </span>grep -r <span class="s2">&quot;register&quot;</span> parts/omelette
</pre></div>
</div>
<p>Si vous développez avec Eclipse/Pydev, vous pouvez ajouter le répertoire
<tt class="file docutils literal"><span class="pre">parts/omelette/</span></tt> au PYTHONPATH du projet, ceci permet l&#8217;exploration du
code en mode &#8220;hypertexte&#8221; (ctrl+clic sur un symbole) et l&#8217;auto completion
intelligente de fonctionner correctement.</p>
</div>
<div class="section" id="utilisation-de-variable">
<h2><a class="toc-backref" href="#id11">Utilisation de variable</a><a class="headerlink" href="#utilisation-de-variable" title="Lien permanent vers ce titre">¶</a></h2>
<p>Vous avez écrit &#8220;archgenxml&#8221; à deux endroits, une fois dans la recipe
<tt class="xref py py-mod docutils literal"><span class="pre">zc.recipe.egg</span></tt> et une autre fois dans la recipe
<tt class="xref py py-mod docutils literal"><span class="pre">collective.recipe.omelette</span></tt>. Il est plus intéressant de l&#8217;indiquer une
seule fois dans une variable et d&#8217;utiliser cette variable ensuite dans les
recipes.</p>
<p>Une convention est de définir une variable <tt class="xref py py-data docutils literal"><span class="pre">eggs</span></tt> dans la section
<tt class="docutils literal"><span class="pre">[buildout]</span></tt> et de récupérer cette variable avec <tt class="docutils literal"><span class="pre">${buildout:eggs}</span></tt>.</p>
<p>Voici ce que donnent les deux fichiers une fois reécrits.</p>
<p class="centered">
<strong><tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt></strong></p><div class="highlight-cfg"><div class="highlight"><pre><span class="k">[buildout]</span>
<span class="na">versions</span> <span class="o">=</span> <span class="s">versions</span>
<span class="na">parts</span> <span class="o">=</span> <span class="s">archgenxml</span>
<span class="na">eggs</span> <span class="o">=</span> <span class="s">archgenxml</span>

<span class="k">[versions]</span>
<span class="na">archgenxml</span> <span class="o">=</span> <span class="s">2.5</span>
<span class="na">distribute</span> <span class="o">=</span> <span class="s">0.6.14</span>
<span class="na">xmiparser</span> <span class="o">=</span> <span class="s">1.5</span>
<span class="na">zc.buildout</span> <span class="o">=</span> <span class="s">1.5.2</span>
<span class="na">zc.recipe.egg</span> <span class="o">=</span> <span class="s">1.3.2</span>
<span class="na">zope.contenttype</span> <span class="o">=</span> <span class="s">3.5.1</span>
<span class="na">zope.i18nmessageid</span> <span class="o">=</span> <span class="s">3.5.3</span>
<span class="na">zope.tal</span> <span class="o">=</span> <span class="s">3.5.2</span>
<span class="na">Unidecode</span> <span class="o">=</span> <span class="s">0.04.1</span>
<span class="na">i18ndude</span> <span class="o">=</span> <span class="s">3.2</span>
<span class="na">ordereddict</span> <span class="o">=</span> <span class="s">1.1</span>
<span class="na">plone.i18n</span> <span class="o">=</span> <span class="s">2.0</span>
<span class="na">pytz</span> <span class="o">=</span> <span class="s">2010l</span>
<span class="na">stripogram</span> <span class="o">=</span> <span class="s">1.5</span>
<span class="na">zope.browser</span> <span class="o">=</span> <span class="s">1.3</span>
<span class="na">zope.component</span> <span class="o">=</span> <span class="s">3.10.0</span>
<span class="na">zope.configuration</span> <span class="o">=</span> <span class="s">3.7.2</span>
<span class="na">zope.documenttemplate</span> <span class="o">=</span> <span class="s">3.4.2</span>
<span class="na">zope.event</span> <span class="o">=</span> <span class="s">3.5.0-1</span>
<span class="na">zope.exceptions</span> <span class="o">=</span> <span class="s">3.6.1</span>
<span class="na">zope.i18n</span> <span class="o">=</span> <span class="s">3.7.4</span>
<span class="na">zope.interface</span> <span class="o">=</span> <span class="s">3.6.1</span>
<span class="na">zope.location</span> <span class="o">=</span> <span class="s">3.9.0</span>
<span class="na">zope.proxy</span> <span class="o">=</span> <span class="s">3.6.1</span>
<span class="na">zope.publisher</span> <span class="o">=</span> <span class="s">3.12.4</span>
<span class="na">zope.schema</span> <span class="o">=</span> <span class="s">3.7.0</span>
<span class="na">zope.security</span> <span class="o">=</span> <span class="s">3.7.4</span>
<span class="na">zope.structuredtext</span> <span class="o">=</span> <span class="s">3.5.0</span>

<span class="k">[archgenxml]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">zc.recipe.egg:scripts</span>
<span class="na">eggs</span> <span class="o">=</span> <span class="s">${buildout:eggs}</span>
</pre></div>
</div>
<p class="centered">
<strong><tt class="file docutils literal"><span class="pre">development.cfg</span></tt></strong></p><div class="highlight-cfg"><div class="highlight"><pre><span class="k">[buildout]</span>
<span class="na">extends</span> <span class="o">=</span> <span class="s">buildout.cfg</span>
<span class="na">parts +</span><span class="o">=</span> <span class="s">omelette</span>

<span class="k">[omelette]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">collective.recipe.omelette</span>
<span class="na">eggs</span> <span class="o">=</span> <span class="s">${buildout:eggs}</span>
</pre></div>
</div>
<p>Vous pouvez référencer n&#8217;importe quelle variable de la section que vous
souhaitez avec <tt class="docutils literal"><span class="pre">${nomdesection:variable}</span></tt>.
Vous pouvez référencer une variable de la même section avec juste <tt class="docutils literal"><span class="pre">${:variable}</span></tt>.</p>
</div>
<div class="section" id="repinning-et-fusion-de-section-de-donnees">
<h2><a class="toc-backref" href="#id12">Repinning et fusion de section de données</a><a class="headerlink" href="#repinning-et-fusion-de-section-de-donnees" title="Lien permanent vers ce titre">¶</a></h2>
<p>Vous voyez que la recipe <tt class="xref py py-mod docutils literal"><span class="pre">collective.recipe.omelette</span></tt> n&#8217;est pas gelé.
Faites donc les modifications suivantes dans <tt class="file docutils literal"><span class="pre">development.cfg</span></tt> :</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="k">[buildout]</span>
<span class="c1"># ...</span>
<span class="na">versions</span> <span class="o">=</span> <span class="s">vers</span>

<span class="k">[vers]</span>
<span class="na">collective.recipe.omelette</span> <span class="o">=</span> <span class="s">0.9</span>
</pre></div>
</div>
<p>Relancez buildout. Vous voyez que seul <tt class="xref py py-mod docutils literal"><span class="pre">collective.recipe.omelette</span></tt> est
gelé maintenant car l&#8217;option <tt class="docutils literal"><span class="pre">versions</span></tt> a été écrasée.</p>
<p>Renommez <tt class="docutils literal"><span class="pre">vers</span></tt> en <tt class="docutils literal"><span class="pre">versions</span></tt> et relancez le buildout.</p>
<p>Tous les eggs sont gélés. En effet la section <tt class="docutils literal"><span class="pre">versions</span></tt> de
<tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt> et la section <tt class="docutils literal"><span class="pre">versions</span></tt> de <tt class="file docutils literal"><span class="pre">development.cfg</span></tt> ont
fusionné.</p>
<p>En conclusion, nommez toujours <tt class="docutils literal"><span class="pre">versions</span></tt> la section contenant les versions.</p>
<p>Mais maintenir deux listes est source d&#8217;erreur. Créez un fichier
<tt class="file docutils literal"><span class="pre">versions.cfg</span></tt> qui contient une section <tt class="docutils literal"><span class="pre">[versions]</span></tt> (pas de section
<tt class="docutils literal"><span class="pre">[buildout]</span></tt>), et dites à <tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt> d&#8217;étendre <tt class="file docutils literal"><span class="pre">versions.cfg</span></tt>.
Relancez buildout pour voir que tout fonctionne.</p>
</div>
<div class="section" id="ordre-d-installation-des-parts">
<h2><a class="toc-backref" href="#id13">Ordre d&#8217;installation des parts</a><a class="headerlink" href="#ordre-d-installation-des-parts" title="Lien permanent vers ce titre">¶</a></h2>
<p>L&#8217;ordre d&#8217;installation des parts n&#8217;est pas forcément l&#8217;ordre donné dans l&#8217;option
<tt class="docutils literal"><span class="pre">parts</span></tt> de <tt class="docutils literal"><span class="pre">[buildout]</span></tt>. Et une part peut très bien être installée si elle
n&#8217;est pas listée dans parts.</p>
<p>Modifiez votre <tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt> comme ceci :</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="k">[buildout]</span>
<span class="c1"># ...</span>
<span class="na">parts</span> <span class="o">=</span> <span class="s">zopeskel archgenxml</span>

<span class="k">[archgenxml]</span>
<span class="c1"># ...</span>
<span class="na">packages</span> <span class="o">=</span> <span class="s">ZopeSkel</span>

<span class="k">[zopeskel]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">zc.recipe.egg</span>
<span class="na">eggs</span> <span class="o">=</span> <span class="s">${archgenxml:packages}</span>
</pre></div>
</div>
<p>Dans cet exemple, il n&#8217;y aucune raison particulière pour installer une part
avant l&#8217;autre. C&#8217;est juste pour l&#8217;exercice.</p>
<p>L&#8217;ordre d&#8217;installation sera <tt class="docutils literal"><span class="pre">[archgenxml]</span></tt>, puis <tt class="docutils literal"><span class="pre">[zopeskel]</span></tt>.  Si
maintenant vous supprimez la part <tt class="docutils literal"><span class="pre">[archgenxml]</span></tt> de <tt class="docutils literal"><span class="pre">parts</span></tt>, elle sera
toujours installée car la part <tt class="docutils literal"><span class="pre">[zopeskel]</span></tt> en dépend, faisant référence
à une de ses variables.</p>
</div>
<div class="section" id="l-option-develop">
<h2><a class="toc-backref" href="#id14">L&#8217;option develop</a><a class="headerlink" href="#l-option-develop" title="Lien permanent vers ce titre">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Cette partie dépend du chapitre <a class="reference internal" href="concepts_python_eggs.html#python-eggs"><em>Concept de Python eggs</em></a>.</p>
</div>
<p>L&#8217;option <tt class="xref py py-data docutils literal"><span class="pre">develop</span></tt> permet d&#8217;indiquer quels eggs sont en mode
développement.</p>
<p>Créez un dossier <tt class="file docutils literal"><span class="pre">src/</span></tt> et déplacez y vos deux eggs <tt class="xref py py-mod docutils literal"><span class="pre">foo.bar</span></tt> et
<tt class="xref py py-mod docutils literal"><span class="pre">foo.rab</span></tt>.</p>
<p>Ajoutez <tt class="xref py py-mod docutils literal"><span class="pre">foo.bar</span></tt> à l&#8217;omelette et relancez <tt class="docutils literal"><span class="pre">bin/buildout</span> <span class="pre">-c</span>
<span class="pre">development.cfg</span></tt>. Buildout tente d&#8217;aller chercher <tt class="xref py py-mod docutils literal"><span class="pre">foo.bar</span></tt> sur
<a class="reference internal" href="glossaire.html#term-pypi"><em class="xref std std-term">Pypi</em></a> et échoue.</p>
<p>Nous allons donc lui dire où le trouver.</p>
<p>Ajoutez à la section <tt class="docutils literal"><span class="pre">[buildout]</span></tt> de <tt class="file docutils literal"><span class="pre">development.cfg</span></tt> :</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="k">[buildout]</span>
<span class="c1"># ...</span>
<span class="na">find-links +</span><span class="o">=</span><span class="s"></span>
<span class="s">    http://devagile:8080/site/products/simple</span>

<span class="na">develop</span> <span class="o">=</span> <span class="s">src/foo.bar</span>
</pre></div>
</div>
<p>Relancez <tt class="docutils literal"><span class="pre">bin/buildout</span> <span class="pre">-c</span> <span class="pre">development.cfg</span></tt>.</p>
<p>Le egg <tt class="xref py py-mod docutils literal"><span class="pre">foo.bar</span></tt> est en mode développement :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>ls -l develop-eggs/
total 12
-rw-r--r-- 1 vincentfretin vincentfretin 57 2009-05-26 18:20 foo.bar.egg-link
-rw-r--r-- 1 vincentfretin vincentfretin 32 2009-05-26 15:38 setuptools.egg-link
</pre></div>
</div>
<p>Nous pouvons également utiliser un wildcard dans l&#8217;option <tt class="docutils literal"><span class="pre">develop</span></tt>. Mettez
<tt class="docutils literal"><span class="pre">develop</span> <span class="pre">=</span> <span class="pre">src/*</span></tt>, du coup les deux eggs <tt class="xref py py-mod docutils literal"><span class="pre">foo.bar</span></tt> et mod:<cite>foo.rab</cite> sont
en développement.</p>
</div>
<div class="section" id="option-index-et-find-links">
<h2><a class="toc-backref" href="#id15">Option index et find-links</a><a class="headerlink" href="#option-index-et-find-links" title="Lien permanent vers ce titre">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Cette partie dépend du chapitre <a class="reference internal" href="concepts_python_eggs.html#python-eggs"><em>Concept de Python eggs</em></a>.</p>
</div>
<p>L&#8217;option <tt class="docutils literal"><span class="pre">index</span></tt> permet de spécifier un autre index que celui par défaut, par
exemple un pypi proxy avec <tt class="xref py py-mod docutils literal"><span class="pre">collective.eggproxy</span></tt>.</p>
<p>L&#8217;option <tt class="docutils literal"><span class="pre">find-links</span></tt> permet d&#8217;indiquer des liens supplémentaires où l&#8217;on peut
trouver les eggs utilisés dans le buildout.</p>
<p>Nous allons maintenant installer <tt class="docutils literal"><span class="pre">foo.bar</span> <span class="pre">=</span> <span class="pre">1.1</span></tt>, la release qu&#8217;il y a sur
notre pypi.</p>
<p>Supprimez donc l&#8217;option <tt class="docutils literal"><span class="pre">develop</span></tt> et dans <tt class="file docutils literal"><span class="pre">development.cfg</span></tt>, ajoutez :</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="k">[buildout]</span>
<span class="c1"># ...</span>
<span class="na">find-links +</span><span class="o">=</span> <span class="s">http://devagile:8080/site/products/simple</span>
</pre></div>
</div>
<p>Dans <tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt>, ajoutez <tt class="docutils literal"><span class="pre">foo.bar</span></tt> à la liste des eggs :</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="k">[buildout]</span>
<span class="c1"># ...</span>
<span class="na">eggs</span> <span class="o">=</span><span class="s"></span>
<span class="s">    archgenxml</span>
<span class="s">    foo.bar</span>
</pre></div>
</div>
<p>Enfin, ajoutez <tt class="docutils literal"><span class="pre">foo.bar</span> <span class="pre">=</span> <span class="pre">1.1</span></tt> dans <tt class="file docutils literal"><span class="pre">versions.cfg</span></tt>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table des matières</a></h3>
  <ul>
<li><a class="reference internal" href="#">Introduction à zc.buildout</a><ul>
<li><a class="reference internal" href="#definition">Définition</a></li>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#organisation-d-un-buildout">Organisation d&#8217;un buildout</a></li>
<li><a class="reference internal" href="#section-principale-buildout">Section principale [buildout]</a></li>
<li><a class="reference internal" href="#partage-du-dossier-eggs-et-downloads">Partage du dossier eggs et downloads</a></li>
<li><a class="reference internal" href="#pinning-des-versions">Pinning des versions</a></li>
<li><a class="reference internal" href="#extension-buildout-dumppickedversions">Extension buildout.dumppickedversions</a></li>
<li><a class="reference internal" href="#option-extends">Option extends</a><ul>
<li><a class="reference internal" href="#option-extends-cache">Option extends-cache</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recipe-collective-recipe-omelette">Recipe collective.recipe.omelette</a></li>
<li><a class="reference internal" href="#utilisation-de-variable">Utilisation de variable</a></li>
<li><a class="reference internal" href="#repinning-et-fusion-de-section-de-donnees">Repinning et fusion de section de données</a></li>
<li><a class="reference internal" href="#ordre-d-installation-des-parts">Ordre d&#8217;installation des parts</a></li>
<li><a class="reference internal" href="#l-option-develop">L&#8217;option develop</a></li>
<li><a class="reference internal" href="#option-index-et-find-links">Option index et find-links</a></li>
</ul>
</li>
</ul>

  <h4>Sujet précédent</h4>
  <p class="topless"><a href="concepts_python_eggs.html"
                        title="Chapitre précédent">Concept de Python eggs</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="installation_et_creation_d_une_instance_Plone.html"
                        title="Chapitre suivant">Installation et création d&#8217;une instance Plone</a></p>
  <h3>Cette page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/presentation_buildout.txt"
           rel="nofollow">Montrer la source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Recherche rapide</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Saisissez un mot clef ou un nom de module, classe ou fonction.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="installation_et_creation_d_une_instance_Plone.html" title="Installation et création d’une instance Plone"
             >suivant</a> |</li>
        <li class="right" >
          <a href="concepts_python_eggs.html" title="Concept de Python eggs"
             >précédent</a> |</li>
        <li><a href="index.html">Formation Plone</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010-2013, Communauté Plone francophone.
      Mis à jour le  07-February-2013.
      Créé avec <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>