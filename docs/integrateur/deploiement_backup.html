
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Déploiement et backup &mdash; Plone pour les intégrateurs 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/plone.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Recherchez dans Plone pour les intégrateurs 1.0.0 documentation"
          href="_static/opensearch.xml"/>
    <link rel="top" title="Plone pour les intégrateurs 1.0.0 documentation" href="index.html" />
    <link rel="next" title="Zope External Editor" href="external_editor.html" />
    <link rel="prev" title="Création d’un buildout Plone avec ZopeSkel" href="buildout_plone3.html" />
<script language="javascript">
//<![CDATA[

Documentation.addTranslations({"locale": "fr", "plural_expr": "(n > 1)", "messages": {"See the definition": "Voir la d\u00e9finition"}});

// See http://disqus.disqus.com/general_integration_help/
var disqus_developer = 1;
if (document.location.protocol == 'http:') {
    disqus_developer = 0;
}

// Some HTML/CSS transforms we can't do in pure CSS (waiting for CSS3 support)
$(document).ready(function () {

    // Style of .. verisonmodified:: , .. versionadded:: ...
    $('p:has(span.versionmodified)').addClass('p-versionmodified');

    // Style of the TOC tree
    $('ul:has(li.toctree-l1)').addClass('toctree');

    // Decorate links to other sites
    $('a[class~=external]').attr('target', '_blank');

    // Glossary terms
    $('em.xref').attr('title', _('See the definition'));

    // We need to have all <pre> in a <div class="highlight"> to mimic pygments
    // to work around a pygments (?) bug
    var suffixes = {cfg: null, python:null};
    for (var suffix in suffixes) {
        var pattern = 'div.highlight-' + suffix + ' > pre';
        $(pattern).wrap('<div class="highlight" />');
    }
    return true;
});
//]]>
</script>

  </head>
  <body>
<!--[if lte IE 6]>
<style type="text/css">
#ie6msg{border:3px solid #090; margin:8px 0; background:#cfc; color:#000;}
#ie6msg h4{margin:8px; padding:0;}
#ie6msg p{margin:8px; padding:0;}
#ie6msg p a.getie8{font-weight:bold; color:#006;}
#ie6msg p a.ie6expl{font-weight:normal; color:#006;}
</style>
<div id="ie6msg">
<h4>Did you know that your browser is out of date?</h4>
<p>If the layout of this site seems ugly, that's because you're actually using
an outdated browser. And we wont put any effort to provide a nice layout to IE6
users.</p>
<p>To get the best possible experience using our website we recommend that you
upgrade your browser to a newer version. The current version
is <a class="getie8"
href="http://upgradeie.s3.amazonaws.com/eng/index.html">Internet Explorer
8</a>. The upgrade is free. If you're using a PC at work you should contact your
IT administrator.</p>
<p>If you want to you may also try some other popular Internet browsers
like <a class="ie6expl"
href="http://getfirefox.com">Firefox</a>, <a class="ie6expl"
href="http://www.google.com/chrome">Chrome</a>, <a class="ie6expl"
href="http://www.opera.com">Opera</a>, or <a class="ie6expl"
href="http://www.apple.com/safari/download/">Safari</a></p>
</div>
<![endif]-->

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="external_editor.html" title="Zope External Editor"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="buildout_plone3.html" title="Création d’un buildout Plone avec ZopeSkel"
             accesskey="P">précédent</a> |</li>
        <li><a href="index.html">Formation Plone</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="deploiement-et-backup">
<span id="deploiement-backup"></span><h1>Déploiement et backup<a class="headerlink" href="#deploiement-et-backup" title="Lien permanent vers ce titre">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Vincent Fretin</td>
</tr>
<tr class="field-even field"><th class="field-name">Contributors:</th><td class="field-body">Thomas Desvenain</td>
</tr>
<tr class="field-odd field"><th class="field-name">Version:</th><td class="field-body">1.0.0</td>
</tr>
<tr class="field-even field"><th class="field-name">Révision:</th><td class="field-body"><a class="reference external" href="https://svn.plone.org/svn/collective/collective.trainingmanual/trunk/fr/integrateur/source/presentation_plone.txt">https://svn.plone.org/svn/collective/collective.trainingmanual/trunk/fr/integrateur/source/presentation_plone.txt</a></td>
</tr>
</tbody>
</table>
<p>Copyright (C) 2010 Vincent Fretin &lt;vincentfretin AT ecreall.com&gt;.</p>
<p>Chacun est autorisé à copier, distribuer et/ou modifier ce document
suivant les termes de la licence Paternité-Pas
d&#8217;Utilisation Commerciale-Partage des Conditions Initiales à l&#8217;Identique 2.0
France accessible à <a class="reference external" href="http://creativecommons.org/licenses/by-nc-sa/2.0/fr">http://creativecommons.org/licenses/by-nc-sa/2.0/fr</a></p>
<p>Le code source présent dans ce document est soumis aux conditions de
la « Zope Public License », Version 2.1 (ZPL).</p>
<p>THE SOURCE CODE IN THIS DOCUMENT AND THE DOCUMENT ITSELF IS PROVIDED
&#8220;AS IS&#8221; AND ANY AND ALL EXPRESS OR IMPLIED WARRANTIES ARE DISCLAIMED,
INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF TITLE,
MERCHANTABILITY, AGAINST INFRINGEMENT, AND FITNESS FOR A PARTICULAR
PURPOSE.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#definition" id="id3">Définition</a></li>
<li><a class="reference internal" href="#savoir" id="id4">Savoir</a></li>
<li><a class="reference internal" href="#profil-de-deploiement" id="id5">Profil de déploiement</a></li>
<li><a class="reference internal" href="#supervisor" id="id6">Supervisor</a></li>
<li><a class="reference internal" href="#support-des-backups" id="id7">Support des backups</a></li>
<li><a class="reference internal" href="#cron-job-pour-zeopack-et-backup" id="id8">Cron job pour zeopack et backup</a></li>
<li><a class="reference internal" href="#configuration-d-apache" id="id9">Configuration d&#8217;Apache</a><ul>
<li><a class="reference internal" href="#activation-de-la-compression" id="id10">Activation de la compression</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuration-des-dns" id="id11">Configuration des DNS</a></li>
<li><a class="reference internal" href="#installation-et-configuration-de-cachefu-plone-4" id="id12">Installation et configuration de CacheFu (&lt; Plone 4)</a><ul>
<li><a class="reference internal" href="#installation" id="id13">Installation</a></li>
<li><a class="reference internal" href="#configuration" id="id14">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation-et-configuration-de-plone-app-caching-plone-4" id="id15">Installation et configuration de plone.app.caching (&gt;= Plone 4)</a><ul>
<li><a class="reference internal" href="#id1" id="id16">Installation</a></li>
<li><a class="reference internal" href="#le-panneau-de-configuration-de-la-gestion-de-cache" id="id17">Le panneau de configuration de la gestion de cache</a></li>
<li><a class="reference internal" href="#id2" id="id18">Configuration</a></li>
<li><a class="reference internal" href="#tester" id="id19">Tester</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ressources" id="id20">Ressources</a></li>
<li><a class="reference internal" href="#exercice" id="id21">Exercice</a></li>
</ul>
</div>
<div class="section" id="definition">
<h2><a class="toc-backref" href="#id3">Définition</a><a class="headerlink" href="#definition" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le déploiement d&#8217;un site Plone requiert des options particulières. Par exemple,
nous voulons être sûr qu&#8217;une configuration d&#8217;un buildout produit la même chose
aujourd&#8217;hui ou dans un an.</p>
<p>Vous avez également des environnements différents, donc vous aurez un fichier
de configuration par environnement (développement, intégration, production,
...). Chaque fichier principal <tt class="file docutils literal"><span class="pre">development.cfg</span></tt>, <tt class="file docutils literal"><span class="pre">deployment.cfg</span></tt>,
<tt class="file docutils literal"><span class="pre">deployment-backup.cfg</span></tt> étant une extension d&#8217;une configuration de
base <tt class="docutils literal"><span class="pre">buildout.cfg</span></tt> intégrant tous les modules applicatifs.</p>
</div>
<div class="section" id="savoir">
<h2><a class="toc-backref" href="#id4">Savoir</a><a class="headerlink" href="#savoir" title="Lien permanent vers ce titre">¶</a></h2>
<ul class="simple">
<li>Profil buildout de déploiement</li>
<li>Mettre en place un backup de la ZODB</li>
<li>Apache</li>
<li>Varnish</li>
<li>HAproxy</li>
<li>CacheFu / plone.app.caching</li>
<li>Supervisor</li>
</ul>
</div>
<div class="section" id="profil-de-deploiement">
<h2><a class="toc-backref" href="#id5">Profil de déploiement</a><a class="headerlink" href="#profil-de-deploiement" title="Lien permanent vers ce titre">¶</a></h2>
<div class="sidebar">
<p class="first sidebar-title">Rappel</p>
<p class="last">Vous pouvez réviser vos connaissances sur <a class="reference internal" href="glossaire.html#term-buildout"><em class="xref std std-term">buildout</em></a> en relisant le
chapitre <a class="reference internal" href="buildout_plone3.html#buildout-plone3"><em>Création d&#8217;un buildout Plone avec ZopeSkel</em></a>.</p>
</div>
<p>Vous pouvez récupérer l&#8217;exemple complet de buildout sur le collective :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>svn co https://svn.plone.org/svn/collective/collective.trainingmanual/trunk/fr/examples/buildout
</pre></div>
</div>
<p>Le <tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt> du chapitre précédent est légèrement modifié :</p>
<p class="centered">
<strong><tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt></strong></p><div class="highlight-cfg"><pre>[buildout]
extends =
    http://dist.plone.org/release/4.0.1/versions.cfg
    http://good-py.appspot.com/release/plone.app.caching/1.0b1?five.grok=1.1.2
    sources.cfg
    versions.cfg
parts +=
    instance1
    zopepy
    repozo
    backup
extensions =
    mr.developer
    buildout.dumppickedversions
always-checkout = force
versions = versions

find-links =
#    http://devagile:8080/site/products/simple
    http://dist.plone.org/release/4.0.1

eggs +=
    Pillow

[instance1]
recipe = plone.recipe.zope2instance
user = admin:admin
http-address = 8280
eggs =
#    formation.policy
    ${buildout:eggs}
environment-vars =
    PYTHON_EGG_CACHE ${buildout:directory}/tmp
    zope_i18n_compile_mo_files true
zcml =
event-log-custom =
  &lt;logfile&gt;
    level info
    path ${buildout:directory}/var/log/${:_buildout_section_name_}.log
    max-size 1MB
    old-files 720
  &lt;/logfile&gt;
  &lt;logfile&gt;
    level error
    path ${buildout:directory}/var/log/error.log
    max-size 1MB
    old-files 720
  &lt;/logfile&gt;
access-log-custom =
  &lt;logfile&gt;
    path ${buildout:directory}/var/log/${:_buildout_section_name_}-Z2.log
    max-size 1MB
    old-files 720
  &lt;/logfile&gt;

[zopepy]
recipe = zc.recipe.egg
eggs = ${instance1:eggs}
interpreter = zopepy
scripts = zopepy

[repozo]
recipe = zc.recipe.egg
eggs = ZODB3 [test]
#scripts = repozo

[backup]
recipe = collective.recipe.backup
keep = 7
full = true
gzip = true
</pre>
</div>
<p>Créez un fichier <tt class="file docutils literal"><span class="pre">deployment.cfg</span></tt> :</p>
<p class="centered">
<strong><tt class="file docutils literal"><span class="pre">deployment.cfg</span></tt></strong></p><div class="highlight-cfg"><div class="highlight"><pre><span class="k">[buildout]</span>
<span class="na">extends-cache</span> <span class="o">=</span> <span class="s">extends-cache</span>
<span class="na">extends</span> <span class="o">=</span><span class="s"></span>
<span class="s">    buildout.cfg</span>
<span class="na">parts +</span><span class="o">=</span><span class="s"></span>
<span class="s">    zeoserver</span>
<span class="s">    instance1</span>
<span class="s">    instance2</span>
<span class="s">    instance3</span>
<span class="s">    instance4</span>
<span class="s">    varnish-build</span>
<span class="s">    varnish-conf</span>
<span class="s">    varnish</span>
<span class="s">    haproxy</span>
<span class="s">    haproxy-conf</span>
<span class="s">    supervisor</span>
<span class="s">    munin1</span>
<span class="s">    munin2</span>
<span class="s">    munin3</span>
<span class="s">    munin4</span>

<span class="na">eggs +</span><span class="o">=</span><span class="s"></span>
<span class="s">    plone.app.caching</span>

<span class="k">[hosts]</span>
<span class="na">zeoserver</span>   <span class="o">=</span> <span class="s">127.0.0.1</span>
<span class="na">instance1</span>   <span class="o">=</span> <span class="s">127.0.0.1</span>
<span class="na">instance2</span>   <span class="o">=</span> <span class="s">127.0.0.1</span>
<span class="na">instance3</span>   <span class="o">=</span> <span class="s">127.0.0.1</span>
<span class="na">instance4</span>   <span class="o">=</span> <span class="s">127.0.0.1</span>
<span class="na">varnish</span>     <span class="o">=</span> <span class="s">127.0.0.1</span>
<span class="na">haproxy</span>     <span class="o">=</span> <span class="s">127.0.0.1</span>
<span class="na">supervisor</span>  <span class="o">=</span> <span class="s">127.0.0.1</span>

<span class="k">[ports]</span>
<span class="na">zeoserver</span>   <span class="o">=</span> <span class="s">8100</span>
<span class="na">instance1</span>   <span class="o">=</span> <span class="s">9880</span>
<span class="na">instance2</span>   <span class="o">=</span> <span class="s">9881</span>
<span class="na">instance3</span>   <span class="o">=</span> <span class="s">9882</span>
<span class="na">instance4</span>   <span class="o">=</span> <span class="s">9883</span>
<span class="na">varnish</span>     <span class="o">=</span> <span class="s">8000</span>
<span class="na">haproxy</span>     <span class="o">=</span> <span class="s">5501</span>
<span class="na">supervisor</span>  <span class="o">=</span> <span class="s">9001</span>

<span class="k">[users]</span>
<span class="na">zope</span>        <span class="o">=</span> <span class="s">zope</span>
<span class="na">varnish</span>     <span class="o">=</span> <span class="s">zope</span>
<span class="na">haproxy</span>     <span class="o">=</span> <span class="s">zope</span>

<span class="k">[zeoserver]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">plone.recipe.zeoserver</span>
<span class="na">zeo-address</span> <span class="o">=</span> <span class="s">${hosts:zeoserver}:${ports:zeoserver}</span>

<span class="k">[instance1]</span>
<span class="na">shared-blob</span> <span class="o">=</span> <span class="s">on</span>
<span class="na">zeo-client</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">zeo-address</span> <span class="o">=</span> <span class="s">${zeoserver:zeo-address}</span>
<span class="na">effective-user</span> <span class="o">=</span> <span class="s">${users:zope}</span>
<span class="na">http-address</span> <span class="o">=</span> <span class="s">${hosts:instance1}:${ports:instance1}</span>

<span class="k">[instance2]</span>
<span class="na">&lt;</span><span class="o">=</span> <span class="s">instance1</span>
<span class="na">http-address</span> <span class="o">=</span> <span class="s">${hosts:instance2}:${ports:instance2}</span>
<span class="na">ftp-address</span> <span class="o">=</span> <span class="s">9821</span>

<span class="k">[instance3]</span>
<span class="na">&lt;</span><span class="o">=</span> <span class="s">instance1</span>
<span class="na">http-address</span> <span class="o">=</span> <span class="s">${hosts:instance3}:${ports:instance3}</span>

<span class="k">[instance4]</span>
<span class="na">&lt;</span><span class="o">=</span> <span class="s">instance1</span>
<span class="na">http-address</span> <span class="o">=</span> <span class="s">${hosts:instance4}:${ports:instance4}</span>

<span class="k">[supervisor]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">collective.recipe.supervisor</span>
<span class="na">port</span> <span class="o">=</span> <span class="s">${ports:supervisor}</span>
<span class="na">user</span> <span class="o">=</span> <span class="s">admin</span>
<span class="na">password</span> <span class="o">=</span> <span class="s">admin</span>
<span class="na">plugins</span> <span class="o">=</span> <span class="s">superlance</span>
<span class="na">supervisord-conf</span> <span class="o">=</span> <span class="s">${buildout:directory}/etc/supervisord.conf</span>
<span class="na">serverurl</span> <span class="o">=</span> <span class="s">http://${hosts:supervisor}:${ports:supervisor}</span>
<span class="na">programs</span> <span class="o">=</span><span class="s"></span>
<span class="s">    10 zeoserver ${zeoserver:location}/bin/runzeo ${zeoserver:location} true ${users:zope}</span>
<span class="s">    20 instance1 ${buildout:bin-directory}/instance1 [console] ${instance1:location} true</span>
<span class="s">    30 instance2 ${buildout:bin-directory}/instance2 [console] ${instance2:location} true</span>
<span class="s">    40 instance3 ${buildout:bin-directory}/instance3 [console] ${instance3:location} true</span>
<span class="s">    50 instance4 ${buildout:bin-directory}/instance4 [console] ${instance4:location} true</span>
<span class="s">    60 haproxy ${buildout:bin-directory}/haproxy [-f ${buildout:directory}/etc/haproxy.conf -db] true</span>
<span class="s">    70 varnish (autorestart=true) ${buildout:bin-directory}/varnish ${varnish:location} true</span>
<span class="na">eventlisteners</span> <span class="o">=</span>
<span class="c1">#    memmon TICK_60 ${buildout:bin-directory}/memmon [-p instance1=600MB -p instance2=600MB -p instance3=600MB -p instance4=600MB -m development+demo@example.com]</span>
<span class="c1">#    crashmail PROCESS_STATE ${buildout:bin-directory}/crashmail [-m development+demo@example.com]</span>

<span class="k">[varnish-build]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">zc.recipe.cmmi</span>
<span class="na">url</span> <span class="o">=</span> <span class="s">${varnish:download-url}</span>

<span class="k">[varnish-conf]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">collective.recipe.template</span>
<span class="na">input</span> <span class="o">=</span> <span class="s">${buildout:directory}/templates/varnish.vcl.in</span>
<span class="na">output</span> <span class="o">=</span> <span class="s">${buildout:directory}/etc/varnish.vcl</span>

<span class="k">[varnish]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">plone.recipe.varnish</span>
<span class="na">daemon</span> <span class="o">=</span> <span class="s">${buildout:parts-directory}/varnish-build/sbin/varnishd</span>
<span class="na">bind</span> <span class="o">=</span> <span class="s">${hosts:varnish}:${ports:varnish}</span>
<span class="c1">#backends = ${haproxy-conf:bind}</span>
<span class="na">config</span> <span class="o">=</span> <span class="s">${varnish-conf:output}</span>
<span class="na">cache-size</span> <span class="o">=</span> <span class="s">256M</span>
<span class="na">user</span> <span class="o">=</span> <span class="s">${users:varnish}</span>
<span class="na">mode</span> <span class="o">=</span> <span class="s">foreground</span>

<span class="k">[haproxy]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">plone.recipe.haproxy</span>
<span class="na">url</span> <span class="o">=</span> <span class="s">${versions:haproxy-url}</span>
<span class="na">cpu</span> <span class="o">=</span> <span class="s">i686</span>
<span class="na">target</span> <span class="o">=</span> <span class="s">linux26</span>
<span class="na">pcre</span> <span class="o">=</span> <span class="s">1</span>

<span class="k">[haproxy-conf]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">collective.recipe.template</span>
<span class="na">input</span> <span class="o">=</span> <span class="s">${buildout:directory}/templates/haproxy.conf.in</span>
<span class="na">output</span> <span class="o">=</span> <span class="s">${buildout:directory}/etc/haproxy.conf</span>
<span class="na">maxconn</span> <span class="o">=</span> <span class="s">32000</span>
<span class="na">ulimit-n</span> <span class="o">=</span> <span class="s">65536</span>
<span class="na">user</span> <span class="o">=</span> <span class="s">${users:haproxy}</span>
<span class="na">group</span> <span class="o">=</span> <span class="s">${users:haproxy}</span>
<span class="na">bind</span> <span class="o">=</span> <span class="s">${hosts:haproxy}:${ports:haproxy}</span>

<span class="k">[munin1]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">zc.recipe.egg</span>
<span class="na">eggs</span> <span class="o">=</span> <span class="s">munin.zope</span>
<span class="na">scripts</span> <span class="o">=</span> <span class="s">munin=munin1</span>
<span class="na">arguments</span> <span class="o">=</span> <span class="s">ip_address=&#39;${hosts:instance1}&#39;, http_address=&#39;${ports:instance1}&#39;, user=&quot;${instance1:user}&quot;</span>

<span class="k">[munin2]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">zc.recipe.egg</span>
<span class="na">eggs</span> <span class="o">=</span> <span class="s">munin.zope</span>
<span class="na">scripts</span> <span class="o">=</span> <span class="s">munin=munin2</span>
<span class="na">arguments</span> <span class="o">=</span> <span class="s">ip_address=&#39;${hosts:instance2}&#39;, http_address=&#39;${ports:instance2}&#39;, user=&quot;${instance2:user}&quot;</span>

<span class="k">[munin3]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">zc.recipe.egg</span>
<span class="na">eggs</span> <span class="o">=</span> <span class="s">munin.zope</span>
<span class="na">scripts</span> <span class="o">=</span> <span class="s">munin=munin3</span>
<span class="na">arguments</span> <span class="o">=</span> <span class="s">ip_address=&#39;${hosts:instance3}&#39;, http_address=&#39;${ports:instance3}&#39;, user=&quot;${instance3:user}&quot;</span>

<span class="k">[munin4]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">zc.recipe.egg</span>
<span class="na">eggs</span> <span class="o">=</span> <span class="s">munin.zope</span>
<span class="na">scripts</span> <span class="o">=</span> <span class="s">munin=munin4</span>
<span class="na">arguments</span> <span class="o">=</span> <span class="s">ip_address=&#39;${hosts:instance4}&#39;, http_address=&#39;${ports:instance4}&#39;, user=&quot;${instance4:user}&quot;</span>
</pre></div>
</div>
<p>Vous allez créer un utilisateur zope qui servira pour lancer le
proxy cache varnish, le load balancer HAproxy et les instances zope.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>sudo adduser zope
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Si vous avez installé un Plone en root avec l&#8217;unified installer,
vous pouvez utiliser le compte <em>plone</em> au lieu de créer un compte
<em>zope</em>. Pour cela remplacer <em>zope</em> par <em>plone</em> dans la section <em>[users]</em>
du fichier <tt class="file docutils literal"><span class="pre">deployment.cfg</span></tt>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Il faut que les fichiers appartiennent à l&#8217;utilisateur zope ou plone ou
vous aurez des problèmes pour démarrer le zeoserver par exemple. Donc
vérifiez que les fichiers ont bien le bon propriétaire :</p>
<div class="last highlight-python"><pre>$ sudo chown -R zope:zope votre_buildout</pre>
</div>
</div>
<p>Relancez le buildout en tant qu&#8217;utilisateur zope avec <strong class="command">bin/buildout -c deployment.cfg</strong>.</p>
</div>
<div class="section" id="supervisor">
<h2><a class="toc-backref" href="#id6">Supervisor</a><a class="headerlink" href="#supervisor" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le buildout génère le fichier <tt class="file docutils literal"><span class="pre">etc/supervisord.conf</span></tt>.</p>
<p>Tous les processus sont gérés par supervisor.</p>
<p>Pour lancer supervisor, lancez le daemon en tant que super utilisateur
qui lancera tous les processus ayant autostart=true (par defaut) :</p>
<div class="highlight-python"><pre>$ sudo bin/supervisord</pre>
</div>
<p>(varnish et haproxy ont besoin d&#8217;être démarrés en root pour activer
certaines options. Les processus sont ensuite forkés pour utiliser
l&#8217;utilisateur zope)</p>
<p>Vous pouvez voir l&#8217;état des processus avec :</p>
<div class="highlight-python"><pre>$ bin/supervisorctl status</pre>
</div>
<p>Pour redémarrer un processus par exemple instance1 :</p>
<div class="highlight-python"><pre>$ bin/supervisorctl restart instance1</pre>
</div>
<p>Pour stopper : <cite>stop</cite>, pour démarrer : <cite>start</cite>.</p>
<p>Pour tout redémarrer :</p>
<div class="highlight-python"><pre>$ bin/supervisorctl restart all</pre>
</div>
<p>Pour arrêter supervisor et donc tous les processus :</p>
<div class="highlight-python"><pre>$ bin/supervisorctl shutdown</pre>
</div>
</div>
<div class="section" id="support-des-backups">
<h2><a class="toc-backref" href="#id7">Support des backups</a><a class="headerlink" href="#support-des-backups" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les backups sont configurés dans la section <tt class="docutils literal"><span class="pre">backup</span></tt>.</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="k">[backup]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">collective.recipe.backup</span>
<span class="na">keep</span> <span class="o">=</span> <span class="s">7</span>
<span class="na">full</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">gzip</span> <span class="o">=</span> <span class="s">true</span>
</pre></div>
</div>
<p>Vous avez par défaut les options suivantes :</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="na">location</span> <span class="o">=</span> <span class="s">${buildout-directory}/var/backups</span>
<span class="na">snapshotlocation</span> <span class="o">=</span> <span class="s">${buildout-directory}/var/snapshotbackups</span>
</pre></div>
</div>
<p><a class="reference external" href="http://pypi.python.org/pypi/collective.recipe.backup">Plus d&#8217;informations sur les options de la recipe</a></p>
<p>Pour exécuter la sauvegarde toutes les nuits, vous pouvez ajouter un cron job
(<strong class="command">crontab -e</strong>), ici à 3h du matin :</p>
<div class="highlight-cfg"><pre>00 3 * * *      /home/zope/MyProject/bin/backup -q</pre>
</div>
<p>Vous allez voir dans la suite une configuration de buildout qui s&#8217;occupe de
créer le cron job à votre place.</p>
<p>Pour faire une restauration :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>bin/restore
</pre></div>
</div>
<p>Si vous voulez faire un backup de la production pour travailler ensuite en local, utilisez plutôt la commande :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>bin/snapshotbackup
</pre></div>
</div>
<p>qui créera une sauvegarde dans le dossier <tt class="file docutils literal"><span class="pre">var/snapshotbackups/</span></tt>, utile
pour ne pas perturber les sauvegardes normales qui se font la nuit.  Vous
récupérez ensuite la sauvegarde (les fichiers <tt class="file docutils literal"><span class="pre">.fsz</span></tt> et <tt class="file docutils literal"><span class="pre">.dat</span></tt>) via
<strong class="command">scp</strong> et vous placez la sauvegarde dans votre dossier
<tt class="file docutils literal"><span class="pre">var/snapshotbackups/</span></tt> en local et exécutez <strong class="command">bin/snapshotrestore</strong> en local.</p>
</div>
<div class="section" id="cron-job-pour-zeopack-et-backup">
<h2><a class="toc-backref" href="#id8">Cron job pour zeopack et backup</a><a class="headerlink" href="#cron-job-pour-zeopack-et-backup" title="Lien permanent vers ce titre">¶</a></h2>
<p>Voici un exemple de configuration qui étend <tt class="file docutils literal"><span class="pre">deployment.cfg</span></tt> pour
réaliser un pack de la database avec la commande <strong class="command">bin/zeopack</strong> et
faire un backup avec la commande <strong class="command">bin/backup</strong> vue précédemment.</p>
<p>Il synchronise également les dossiers <tt class="file docutils literal"><span class="pre">backup/</span></tt> et <tt class="file docutils literal"><span class="pre">log/</span></tt> sur un autre serveur.</p>
<p>Tout cela est réalisé par un job cron à 4h du matin.</p>
<p class="centered">
<strong><tt class="file docutils literal"><span class="pre">deployment-backup.cfg</span></tt></strong></p><div class="highlight-cfg"><div class="highlight"><pre><span class="k">[buildout]</span>
<span class="na">extends-cache</span> <span class="o">=</span> <span class="s">extends-cache</span>
<span class="na">extends</span> <span class="o">=</span> <span class="s">deployment.cfg</span>
<span class="na">parts +</span><span class="o">=</span><span class="s"></span>
<span class="s">    backup-template</span>
<span class="s">    backup-schedule</span>

<span class="k">[backup-template]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">collective.recipe.template</span>
<span class="na">inline</span> <span class="o">=</span><span class="s"></span>
<span class="s">    #!/bin/bash</span>
<span class="s">    ${buildout:bin-directory}/zeopack</span>
<span class="s">    ${buildout:bin-directory}/backup -q</span>
<span class="s">    blob=$(basename `ls ${backup:location}|tail -n1` .fsz)</span>
<span class="s">    cd ${buildout:directory}</span>
<span class="s">    tar zcf ${backup:location}/$blob.tar.gz var/blobstorage</span>
<span class="s">    toremove=`ls ${backup:location}/*.tar.gz|sort -r|tail -n+8`</span>
<span class="s">    if [ ! -z &quot;$toremove&quot;]; then rm $toremove; fi</span>
<span class="s">    rsync -a --delete ${backup:location}/ sav@serveur1.example.com:/home/sav/Plone/backups/</span>
<span class="s">    rsync -a --delete ${buildout:directory}/var/log/ sav@serveur1.example.com:/home/sav/Plone/log/</span>
<span class="na">output</span> <span class="o">=</span> <span class="s">${buildout:bin-directory}/backup.sh</span>
<span class="na">mode</span> <span class="o">=</span> <span class="s">755</span>

<span class="k">[backup-schedule]</span>
<span class="na">recipe</span> <span class="o">=</span> <span class="s">z3c.recipe.usercrontab</span>
<span class="na">times</span> <span class="o">=</span> <span class="s">0 4 * * *</span>
<span class="na">command</span> <span class="o">=</span> <span class="s">${backup-template:output}</span>
</pre></div>
</div>
<p>Dans cet exemple, la synchronisation se fait sur le serveur de secours/backup
<em>serveur1.example.com</em> avec le login <em>save</em>. Il vous faut préalablement partager
une clé publique entre ces deux serveurs pour que la commande <strong class="command">rsync</strong>
ne demande aucun mot de passe.</p>
<p>Pour utiliser cette configuration, exécutez <strong class="command">bin/buildout -c
deployment-backup.cfg</strong>.  Le cron job sera automatiquement ajouté dans le crontab
de l&#8217;utilisateur.</p>
</div>
<div class="section" id="configuration-d-apache">
<h2><a class="toc-backref" href="#id9">Configuration d&#8217;Apache</a><a class="headerlink" href="#configuration-d-apache" title="Lien permanent vers ce titre">¶</a></h2>
<p>Création d&#8217;un certificat autosigné :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>sudo mkdir -p /etc/apache2/ssl/
<span class="nv">$ </span>sudo make-ssl-cert /usr/share/ssl-cert/ssleay.cnf <span class="se">\</span>
  /etc/apache2/ssl/server.crt
</pre></div>
</div>
<p><tt class="file docutils literal"><span class="pre">/etc/apache2/sites-available/devagile</span></tt> :</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nb">NameVirtualHost</span> <span class="m">127.0.0.1</span>

<span class="nt">&lt;VirtualHost</span> <span class="s">127.0.0.1:80</span><span class="nt">&gt;</span>
    <span class="nb">ServerName</span> devagile
    <span class="nb">ServerAdmin</span> anthony.sombris@devagile.fr
    <span class="nb">ErrorLog</span> <span class="sx">/var/log/apache2/devagile_error.log</span>
    <span class="nb">TransferLog</span> <span class="sx">/var/log/apache2/devagile_access.log</span>
    <span class="nb">LogLevel</span> <span class="k">warn</span>
    <span class="nb">RewriteEngine</span> <span class="k">On</span>
    <span class="nb">RewriteRule</span> ^/(.*) https://ssl.devagile/$1 [NC,R=301,L]

<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</div>
<p><tt class="file docutils literal"><span class="pre">/etc/apache2/sites-available/ssl.devagile</span></tt> (dans la RewriteRule, changez Plone par le nom de votre site plone) :</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nb">NameVirtualHost</span> <span class="m">127.0.0.1</span>:443

<span class="nt">&lt;VirtualHost</span> <span class="s">127.0.0.1:443</span><span class="nt">&gt;</span>
    <span class="nb">ServerName</span> ssl.devagile
    <span class="nb">ServerAdmin</span> anthony.sombris@devagile.fr
    <span class="nb">ErrorLog</span> <span class="sx">/var/log/apache2/devagile_error.log</span>
    <span class="nb">TransferLog</span> <span class="sx">/var/log/apache2/devagile_access.log</span>
    <span class="nb">LogLevel</span> <span class="k">warn</span>

    <span class="nb">SSLEngine</span> <span class="k">On</span>
    <span class="nb">SSLCertificateFile</span> <span class="sx">/etc/apache2/ssl/server.crt</span>
    <span class="c">#SSLCertificateKeyFile /etc/apache2/ssl/server.key</span>

    <span class="nb">RewriteEngine</span> <span class="k">On</span>
    <span class="nb">RewriteRule</span> ^/(.*) http://localhost:8000/VirtualHostBase/https/%{SERVER_NAME}:443/Plone/VirtualHostRoot/$1 [L,P]

    <span class="nt">&lt;IfModule</span> <span class="s">mod_proxy.c</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Proxy</span> <span class="s">proxy:http://localhost:8000</span><span class="nt">&gt;</span>
            <span class="nb">Order</span> deny,allow
            <span class="nb">Allow</span> from localhost
        <span class="nt">&lt;/Proxy&gt;</span>
    <span class="nt">&lt;/IfModule&gt;</span>
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</div>
<p>Activez les sites :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>a2ensite devagile
<span class="nv">$ </span>a2ensite ssl.devagile
</pre></div>
</div>
<p>Activez les modules :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>a2enmod ssl
<span class="nv">$ </span>a2enmod dav
<span class="nv">$ </span>a2enmod proxy
<span class="nv">$ </span>a2enmod proxy_http
<span class="nv">$ </span>a2enmod rewrite
</pre></div>
</div>
<div class="section" id="activation-de-la-compression">
<h3><a class="toc-backref" href="#id10">Activation de la compression</a><a class="headerlink" href="#activation-de-la-compression" title="Lien permanent vers ce titre">¶</a></h3>
<p>Activez le module <em>deflate</em> :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>a2enmod deflate
</pre></div>
</div>
<p>et éditez le fichier de configuration
<tt class="file docutils literal"><span class="pre">/etc/apache2/mods-enabled/deflate.conf</span></tt> (ce n&#8217;est plus nécessaire avec Ubuntu 10.04 et plus) :</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nt">&lt;IfModule</span> <span class="s">mod_deflate.c</span><span class="nt">&gt;</span>
        <span class="c"># these are known to be safe with MSIE 6</span>
        <span class="nb">AddOutputFilterByType</span> DEFLATE text/html text/plain text/xml

        <span class="c"># everything else may cause problems with MSIE 6</span>
        <span class="nb">AddOutputFilterByType</span> DEFLATE text/css
        <span class="nb">AddOutputFilterByType</span> DEFLATE application/x-javascript application/javascript application/ecmascript
        <span class="nb">AddOutputFilterByType</span> DEFLATE application/rss+xml
<span class="nt">&lt;/IfModule&gt;</span>
</pre></div>
</div>
<p>Redémarrez Apache :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>/etc/init.d/apache2 restart
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuration-des-dns">
<h2><a class="toc-backref" href="#id11">Configuration des DNS</a><a class="headerlink" href="#configuration-des-dns" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour configurer vos DNS ou pour tester en local, éditez <tt class="file docutils literal"><span class="pre">/etc/hosts</span></tt> :</p>
<div class="highlight-text"><div class="highlight"><pre>127.0.0.1 devagile ssl.devagile
</pre></div>
</div>
<p>Redémarrez Firefox pour qu&#8217;il relise le fichier.</p>
<p>Vous accéderez à votre site à partir de maintenant avec l&#8217;adresse
<strong>http://devagile</strong>.</p>
</div>
<div class="section" id="installation-et-configuration-de-cachefu-plone-4">
<h2><a class="toc-backref" href="#id12">Installation et configuration de CacheFu (&lt; Plone 4)</a><a class="headerlink" href="#installation-et-configuration-de-cachefu-plone-4" title="Lien permanent vers ce titre">¶</a></h2>
<p>CacheFu est un module pour gérer les règles de cache HTTP pour Plone &lt; 4.</p>
<div class="section" id="installation">
<h3><a class="toc-backref" href="#id13">Installation</a><a class="headerlink" href="#installation" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour installer CacheFu il suffit d&#8217;ajouter <tt class="xref py py-mod docutils literal"><span class="pre">Products.CacheSetup</span></tt>
soit dans la liste des eggs de votre buildout, soit en tant que dépendance à
l&#8217;un de vos projets dans le <tt class="file docutils literal"><span class="pre">setup.py</span></tt>.
Vous devez ensuite l&#8217;installer par la suite comme un module supplémentaire
dans le panneau de configuration de Plone via l&#8217;utilitaire
<em class="guilabel">Ajout/Suppression de produits</em>.</p>
</div>
<div class="section" id="configuration">
<h3><a class="toc-backref" href="#id14">Configuration</a><a class="headerlink" href="#configuration" title="Lien permanent vers ce titre">¶</a></h3>
<p>Allez avec le navigateur en tant qu&#8217;administrateur dans
<em class="guilabel">Configuration du site</em>
-&gt; <em class="guilabel">Cache Configuration Tool</em> et configurez de la manière suivante :</p>
<ul class="simple">
<li>Cocher Enable CacheFu</li>
<li>Active Cache Policy: With Caching Proxy</li>
<li>Proxy Cache Purge Configuration: Purge with VHM URLS</li>
<li>Site Domains: <a class="reference external" href="https://ssl.devagile:443">https://ssl.devagile:443</a></li>
<li>Proxy Cache Domains: <a class="reference external" href="http://127.0.0.1:8000">http://127.0.0.1:8000</a></li>
<li>Compression: Never</li>
</ul>
</div>
</div>
<div class="section" id="installation-et-configuration-de-plone-app-caching-plone-4">
<h2><a class="toc-backref" href="#id15">Installation et configuration de plone.app.caching (&gt;= Plone 4)</a><a class="headerlink" href="#installation-et-configuration-de-plone-app-caching-plone-4" title="Lien permanent vers ce titre">¶</a></h2>
<p><tt class="xref py py-mod docutils literal"><span class="pre">plone.app.caching</span></tt> propose comme CacheFu une interface graphique pour gérer
les règles de cache HTTP pour Plone 4. Il est construit sur <tt class="xref py py-mod docutils literal"><span class="pre">z3c.caching</span></tt>,
<tt class="xref py py-mod docutils literal"><span class="pre">plone.caching</span></tt> et <tt class="xref py py-mod docutils literal"><span class="pre">plone.cachepurging</span></tt>.</p>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id16">Installation</a><a class="headerlink" href="#id1" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour installer plone.app.caching il suffit de l&#8217;ajouter soit dans la liste
des eggs de votre buildout, soit en tant que dépendance à l&#8217;un de vos projets
dans le <tt class="file docutils literal"><span class="pre">setup.py</span></tt>.
Vous devez ensuite l&#8217;installer comme un module supplémentaire
dans le panneau de configuration de Plone via l&#8217;utilitaire d&#8217;ajout de modules.
Comme ce module dépend d&#8217;un certain nombre de modules qui ne sont pas fournis
par Plone, il est plus sûr de geler les versions dans votre buildout comme
suit :</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="na">extends</span> <span class="o">=</span><span class="s"></span>
<span class="s">    # ...</span>
<span class="s">    http://good-py.appspot.com/release/plone.app.caching/1.0b1</span>
</pre></div>
</div>
<p>Vous pouvez avoir une vue des versions disponibles ici :
<a class="reference external" href="http://good-py.appspot.com/release/plone.app.caching">http://good-py.appspot.com/release/plone.app.caching</a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="http://good-py.appspot.com">http://good-py.appspot.com</a> est une application Google App Engine créée par
Martin Aspeli pour gérer un ensemble de KGS (Know Good Set),
avec des contraintes de versions compatibles et incompatibles. Par exemple
pour récupérer le KGS de plone.app.caching et de five.grok, vous pouvez
utiliser l&#8217;url suivante :
<a class="reference external" href="http://good-py.appspot.com/release/plone.app.caching/1.0b1?five.grok=1.1.2">http://good-py.appspot.com/release/plone.app.caching/1.0b1?five.grok=1.1.2</a>
Pour récupérer un KGS de five.grok compatible avec Plone 3.3 qui utilise
Zope 2.10.x : <a class="reference external" href="http://good-py.appspot.com/release/five.grok/1.1.2?zope=2.10.x">http://good-py.appspot.com/release/five.grok/1.1.2?zope=2.10.x</a></p>
</div>
</div>
<div class="section" id="le-panneau-de-configuration-de-la-gestion-de-cache">
<h3><a class="toc-backref" href="#id17">Le panneau de configuration de la gestion de cache</a><a class="headerlink" href="#le-panneau-de-configuration-de-la-gestion-de-cache" title="Lien permanent vers ce titre">¶</a></h3>
<p>Une fois installé vous allez trouver au niveau de la configuration de votre
site un lien pour configurer les règles de cache de votre site.</p>
<div class="figure align-center">
<img alt="_images/liencaching.png" src="_images/liencaching.png" />
</div>
<p>Cette interface graphique est constituée de trois onglets :</p>
<div class="figure align-center">
<img alt="_images/3onglets.png" src="_images/3onglets.png" />
</div>
<ol class="arabic simple">
<li><em>Changer la configuration</em> (Change settings) : pour gérer le comportement
du cache HTTP</li>
<li><em>Importer une configuration</em> (Import settings) : vous permet d&#8217;importer
des politiques de cache prédéfinies</li>
<li><em>RAM cache</em> : fournit des informations statistiques sur le cache en RAM
et son éventuelle purge.</li>
</ol>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id18">Configuration</a><a class="headerlink" href="#id2" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans notre exemple, nous avons un cache proxy varnish derrière Apache.
Pour configurer cette chaine, faire ce qui suit :</p>
<ul class="simple">
<li>Cliquer sur <em class="guilabel">Import settings</em>, sélectionner
<em class="guilabel">With caching proxy</em>, cliquer sur <em class="guilabel">Import</em></li>
<li>Retourner dans <em class="guilabel">Change settings</em>, dans
<em class="guilabel">Global settings</em>, cocher <em class="guilabel">Enable caching</em></li>
<li>Dans l&#8217;onglet <em class="guilabel">Caching proxies</em>, cocher <em class="guilabel">Enable purging</em></li>
<li>Ajouter <a class="reference external" href="http://127.0.0.1:8000">http://127.0.0.1:8000</a> dans les <cite>Caching proxies</cite>.</li>
<li>Cocher <cite>Virtual host rewriting takes place front of the caching proxy</cite> car
les adresses sont réécrites par Apache avec le RewriteRule.</li>
<li>Dans <cite>Externally facing domains</cite>, mettre <a class="reference external" href="https://ssl.devagile:443">https://ssl.devagile:443</a></li>
<li>Cliquer sur <cite>Save</cite></li>
</ul>
<p>Le mieux après est d&#8217;exporter cette configuration dans formation.policy.
Pour cela aller dans portal_setup, export, <cite>Export the configuration registry schemata</cite>.
Ajouter le fichier registry.xml dans votre dossier <tt class="file docutils literal"><span class="pre">profiles/default/</span></tt>.
Eventuellement nettoyer ce fichier, seules les clés commencant par
plone.app.caching nous intéressent.</p>
<p>Pour aller plus loin :
<a class="reference external" href="http://dev.plone.org/plone/browser/plone.app.caching/trunk/README.txt">http://dev.plone.org/plone/browser/plone.app.caching/trunk/README.txt</a></p>
</div>
<div class="section" id="tester">
<h3><a class="toc-backref" href="#id19">Tester</a><a class="headerlink" href="#tester" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous pouvez tester que votre configuration fonctionne bien en inspectant
les requêtes HTTP avec l&#8217;extension Firebug de Firefox par exemple.</p>
</div>
</div>
<div class="section" id="ressources">
<h2><a class="toc-backref" href="#id20">Ressources</a><a class="headerlink" href="#ressources" title="Lien permanent vers ce titre">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://vincentfretin.ecreall.com/articles/varnish-guru-meditation-on-timeout">Varnish Guru Meditation on timeout</a></li>
<li><a class="reference external" href="http://scalingplone.pbworks.com/">Plone Scaling and Performance</a> par Elizabeth Leddy</li>
</ul>
<p>Apache et Zope, VirtualHostMonster :</p>
<ul class="simple">
<li><a class="reference external" href="http://plone.org/documentation/tutorial/plone-apache/vhm/">http://plone.org/documentation/tutorial/plone-apache/vhm/</a></li>
<li><a class="reference external" href="http://plone.org/documentation/how-to/plone-with-apache">http://plone.org/documentation/how-to/plone-with-apache</a></li>
<li><a class="reference external" href="http://www.zope.org/Documentation/Books/ZopeBook/2_6Edition/VirtualHosting.stx">http://www.zope.org/Documentation/Books/ZopeBook/2_6Edition/VirtualHosting.stx</a></li>
<li><a class="reference external" href="http://wiki.zope.org/zope2/ZopeAndApache">http://wiki.zope.org/zope2/ZopeAndApache</a></li>
<li><a class="reference external" href="http://doc.ubuntu-fr.org/tutoriel/securiser_apache2_avec_ssl">http://doc.ubuntu-fr.org/tutoriel/securiser_apache2_avec_ssl</a></li>
</ul>
<p>Erreurs PosKey dans vos ZODB storages :</p>
<ul class="simple">
<li><a class="reference external" href="http://www.zopyx.de/blog/checking-your-zodb-storages-for-poskey-errors">Checking your ZODB storages for PosKey errors</a></li>
</ul>
</div>
<div class="section" id="exercice">
<h2><a class="toc-backref" href="#id21">Exercice</a><a class="headerlink" href="#exercice" title="Lien permanent vers ce titre">¶</a></h2>
<p>Geler toutes les versions des eggs utilisés dans le buildout.</p>
<p>Ajout de la recipe collective.recipe.backup dans le buildout pour réaliser un backup régulier de la base de données.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo"><a href="index.html"><img src="_static/plone-icon-64.png" />
</a></p>

  <h3><a href="index.html">Table des matières</a></h3>
  <ul>
<li><a class="reference internal" href="#">Déploiement et backup</a><ul>
<li><a class="reference internal" href="#definition">Définition</a></li>
<li><a class="reference internal" href="#savoir">Savoir</a></li>
<li><a class="reference internal" href="#profil-de-deploiement">Profil de déploiement</a></li>
<li><a class="reference internal" href="#supervisor">Supervisor</a></li>
<li><a class="reference internal" href="#support-des-backups">Support des backups</a></li>
<li><a class="reference internal" href="#cron-job-pour-zeopack-et-backup">Cron job pour zeopack et backup</a></li>
<li><a class="reference internal" href="#configuration-d-apache">Configuration d&#8217;Apache</a><ul>
<li><a class="reference internal" href="#activation-de-la-compression">Activation de la compression</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuration-des-dns">Configuration des DNS</a></li>
<li><a class="reference internal" href="#installation-et-configuration-de-cachefu-plone-4">Installation et configuration de CacheFu (&lt; Plone 4)</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation-et-configuration-de-plone-app-caching-plone-4">Installation et configuration de plone.app.caching (&gt;= Plone 4)</a><ul>
<li><a class="reference internal" href="#id1">Installation</a></li>
<li><a class="reference internal" href="#le-panneau-de-configuration-de-la-gestion-de-cache">Le panneau de configuration de la gestion de cache</a></li>
<li><a class="reference internal" href="#id2">Configuration</a></li>
<li><a class="reference internal" href="#tester">Tester</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ressources">Ressources</a></li>
<li><a class="reference internal" href="#exercice">Exercice</a></li>
</ul>
</li>
</ul>

  <h4>Sujet précédent</h4>
  <p class="topless"><a href="buildout_plone3.html"
                        title="Chapitre précédent">Création d&#8217;un buildout Plone avec ZopeSkel</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="external_editor.html"
                        title="Chapitre suivant">Zope External Editor</a></p>
  <h3>Cette page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/deploiement_backup.txt"
           rel="nofollow">Montrer la source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Recherche rapide</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Saisissez un mot clef ou un nom de module, classe ou fonction.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="external_editor.html" title="Zope External Editor"
             >suivant</a> |</li>
        <li class="right" >
          <a href="buildout_plone3.html" title="Création d’un buildout Plone avec ZopeSkel"
             >précédent</a> |</li>
        <li><a href="index.html">Formation Plone</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010-2013, Communauté Plone francophone.
      Mis à jour le  07-February-2013.
      Créé avec <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>

<hr />
<div id="disqus_thread">
</div>
<script type="text/javascript"
        src="http://disqus.com/forums/plonepourlesintgrateurs/embed.js">
</script>
<noscript>
  <a href="http://disqus.com/forums/plonepourlesintgrateurs/?url=ref">
    View the discussion thread.
  </a>
</noscript>
<a href="http://disqus.com"
   class="dsq-brlink">blog comments powered by
  <span class="logo-disqus">Disqus</span>
</a>
<script type="text/javascript">
//<![CDATA[
(function() {
  var links = document.getElementsByTagName('a');
  var query = '?';
  for(var i = 0; i < links.length; i++) {
    if(links[i].href.indexOf('#disqus_thread') >= 0) {
      query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
    }
    // Not a Jinja end block
  }
  document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/plonepourlesintgrateurs/get_num_replies.js' + query + '"></' + 'script>');
})();
//]]>
</script>


  </body>
</html>