

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>TAL/Metal les templates de Zope et Plone &mdash; Plone pour les intégrateurs 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Recherchez dans Plone pour les intégrateurs 1.0.0 documentation"
          href="_static/opensearch.xml"/>
    <link rel="top" title="Plone pour les intégrateurs 1.0.0 documentation" href="index.html" />
    <link rel="next" title="Paramétrage local des workflows" href="workflows-locaux.html" />
    <link rel="prev" title="PloneFormGen" href="ploneformgen/index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="workflows-locaux.html" title="Paramétrage local des workflows"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="ploneformgen/index.html" title="PloneFormGen"
             accesskey="P">précédent</a> |</li>
        <li><a href="index.html">Formation Plone</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tal-metal-les-templates-de-zope-et-plone">
<span id="tal-metal"></span><h1>TAL/Metal les templates de Zope et Plone<a class="headerlink" href="#tal-metal-les-templates-de-zope-et-plone" title="Lien permanent vers ce titre">¶</a></h1>
<p>Les Zope Page Templates sont un mécanisme permettant d&#8217;écrire des pages xhtml
dynamiques.</p>
<p>Ces ZPT utilisent un langage de template XML TAL/METAL.  L&#8217;objectif est d&#8217;être
capable de comprendre, créer et modifier les pages dynamiques.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#le-langage-tal" id="id6">Le langage TAL</a><ul>
<li><a class="reference internal" href="#savoir" id="id7">Savoir</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tales" id="id8">TALES</a><ul>
<li><a class="reference internal" href="#id1" id="id9">Savoir</a></li>
</ul>
</li>
<li><a class="reference internal" href="#metal" id="id10">METAL</a><ul>
<li><a class="reference internal" href="#id2" id="id11">Savoir</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ressources" id="id12">Ressources</a></li>
<li><a class="reference internal" href="#namespaces" id="id13">Namespaces</a></li>
<li><a class="reference internal" href="#variables-globales" id="id14">Variables globales</a></li>
<li><a class="reference internal" href="#presentation-des-zpt" id="id15">Présentation des ZPT</a></li>
<li><a class="reference internal" href="#id3" id="id16">Le langage TAL</a><ul>
<li><a class="reference internal" href="#liste-des-commandes" id="id17">Liste des commandes</a></li>
<li><a class="reference internal" href="#ordre-d-evaluation" id="id18">Ordre d&#8217;évaluation</a></li>
<li><a class="reference internal" href="#content-et-replace" id="id19">Content et Replace</a></li>
<li><a class="reference internal" href="#condition" id="id20">Condition</a></li>
<li><a class="reference internal" href="#attributes" id="id21">Attributes</a></li>
<li><a class="reference internal" href="#define" id="id22">Define</a></li>
<li><a class="reference internal" href="#repeat" id="id23">Repeat</a></li>
<li><a class="reference internal" href="#on-error" id="id24">On-error</a></li>
<li><a class="reference internal" href="#omit-tag" id="id25">Omit-tag</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id4" id="id26">TALES</a><ul>
<li><a class="reference internal" href="#definition" id="id27">Définition</a></li>
<li><a class="reference internal" href="#exemples" id="id28">Exemples</a><ul>
<li><a class="reference internal" href="#path" id="id29">Path</a></li>
<li><a class="reference internal" href="#path-alternatif-et-nothing" id="id30">Path alternatif et nothing</a></li>
<li><a class="reference internal" href="#not" id="id31">Not</a></li>
<li><a class="reference internal" href="#string" id="id32">String</a></li>
<li><a class="reference internal" href="#nocall" id="id33">Nocall</a></li>
<li><a class="reference internal" href="#python" id="id34">Python</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id5" id="id35">METAL</a><ul>
<li><a class="reference internal" href="#metal-define-macro" id="id36">metal:define-macro</a></li>
<li><a class="reference internal" href="#metal-define-slot" id="id37">metal:define-slot</a></li>
<li><a class="reference internal" href="#metal-use-macro" id="id38">metal:use-macro</a></li>
<li><a class="reference internal" href="#metal-fill-slot" id="id39">metal:fill-slot</a><ul>
<li><a class="reference internal" href="#tips" id="id40">Tips</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#exercice" id="id41">Exercice</a></li>
</ul>
</div>
<div class="section" id="le-langage-tal">
<h2><a class="toc-backref" href="#id6">Le langage TAL</a><a class="headerlink" href="#le-langage-tal" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="savoir">
<h3><a class="toc-backref" href="#id7">Savoir</a><a class="headerlink" href="#savoir" title="Lien permanent vers ce titre">¶</a></h3>
<ul class="simple">
<li>Liste des commandes</li>
<li>Ordre d&#8217;évaluation</li>
<li>Content et Replace</li>
<li>Condition</li>
<li>Define</li>
<li>Repeat</li>
<li>On-error</li>
<li>Omit-tag</li>
</ul>
</div>
</div>
<div class="section" id="tales">
<h2><a class="toc-backref" href="#id8">TALES</a><a class="headerlink" href="#tales" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id9">Savoir</a><a class="headerlink" href="#id1" title="Lien permanent vers ce titre">¶</a></h3>
<ul class="simple">
<li>Exemples</li>
<li>Path</li>
<li>Path alternatif et nothing</li>
<li>Not</li>
<li>String</li>
<li>Nocall</li>
<li>Python</li>
</ul>
</div>
</div>
<div class="section" id="metal">
<h2><a class="toc-backref" href="#id10">METAL</a><a class="headerlink" href="#metal" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id11">Savoir</a><a class="headerlink" href="#id2" title="Lien permanent vers ce titre">¶</a></h3>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">metal:define-macro</span></tt></li>
<li><tt class="docutils literal"><span class="pre">metal:define-slot</span></tt></li>
<li><tt class="docutils literal"><span class="pre">metal:use-macro</span></tt></li>
<li><tt class="docutils literal"><span class="pre">metal:fill-slot</span></tt></li>
</ul>
</div>
</div>
<div class="section" id="ressources">
<h2><a class="toc-backref" href="#id12">Ressources</a><a class="headerlink" href="#ressources" title="Lien permanent vers ce titre">¶</a></h2>
<p>Lire la documentation <a class="reference external" href="http://plone.org/documentation/tutorial/zpt">ZPT - Zope Page Templates</a> sur plone.org.</p>
<p>À noter que certains exemples avec <tt class="docutils literal"><span class="pre">tal:repeat</span></tt> sont faux.</p>
<p>Un <tt class="docutils literal"><span class="pre">tal:repeat</span></tt> sur une balise <tt class="docutils literal"><span class="pre">&lt;ul</span> <span class="pre">..&gt;</span></tt> ou <tt class="docutils literal"><span class="pre">&lt;tbody</span> <span class="pre">...&gt;</span></tt> répètera la
balise à chaque tour de boucle. Le <tt class="docutils literal"><span class="pre">tal:repeat</span></tt> devrait donc se situer sur un
<tt class="docutils literal"><span class="pre">&lt;li</span> <span class="pre">...&gt;</span></tt> ou un <tt class="docutils literal"><span class="pre">&lt;tr</span> <span class="pre">...&gt;</span></tt>.</p>
<p>Petit rappel sur les tableaux : vous pouvez mettre un <tt class="docutils literal"><span class="pre">&lt;tr&gt;</span></tt> dans un
<tt class="docutils literal"><span class="pre">&lt;thead&gt;</span></tt> pour avoir une ligne d&#8217;en-tête sur chaque page lors de l&#8217;impression
d&#8217;un tableau. Il va de même pour un pied de page avec la balise <tt class="docutils literal"><span class="pre">&lt;tfoot&gt;</span></tt>.</p>
<p>Dans le document ci-dessus, il manque les commandes <tt class="docutils literal"><span class="pre">tal:omit-tag</span></tt> et
<tt class="docutils literal"><span class="pre">tal:on-error</span></tt>, cela est expliqué dans le ZopeBook :</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.zope.org/zope2/zope2book/ZPT.html">Using Zope Page Templates</a></li>
<li><a class="reference external" href="http://docs.zope.org/zope2/zope2book/AdvZPT.html">Advanced Page Templates</a></li>
<li><a class="reference external" href="http://docs.zope.org/zope2/zope2book/AppendixC.html">Appendix C: Zope Page Templates Reference</a></li>
</ul>
<p>La documentation sur plone.org et celle dans le ZopeBook se ressemble beaucoup.
Les pages dans le ZopeBook sont complémentaires à la documentation sur
plone.org.</p>
</div>
<div class="section" id="namespaces">
<h2><a class="toc-backref" href="#id13">Namespaces</a><a class="headerlink" href="#namespaces" title="Lien permanent vers ce titre">¶</a></h2>
<p>Prenez l&#8217;habitude de toujours inclure les namespaces dans vos templates.  Ils
seront nécessaires pour le nouveau moteur de template Chameleon qui parse la
page de manière stricte.</p>
<p>La structure minimale est donc :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span>
      <span class="na">xmlns:tal=</span><span class="s">&quot;http://xml.zope.org/namespaces/tal&quot;</span>
      <span class="na">xmlns:metal=</span><span class="s">&quot;http://xml.zope.org/namespaces/metal&quot;</span>
      <span class="na">xmlns:i18n=</span><span class="s">&quot;http://xml.zope.org/namespaces/i18n&quot;</span>
      <span class="na">xml:lang=</span><span class="s">&quot;en&quot;</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span>
      <span class="na">metal:use-macro=</span><span class="s">&quot;context/main_template/macros/master&quot;</span>
      <span class="na">i18n:domain=</span><span class="s">&quot;mydomain&quot;</span><span class="nt">&gt;</span>
  ...
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Vous pouvez vérifier si vos templates sont bien valides XML avec la commande <tt class="docutils literal"><span class="pre">xmllint</span> <span class="pre">matemplate.pt</span></tt>.</p>
</div>
<div class="section" id="variables-globales">
<h2><a class="toc-backref" href="#id14">Variables globales</a><a class="headerlink" href="#variables-globales" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans Plone 3.3, vous avez accès à des variables et fonctions globalement dans
vos pages templates. Vous n&#8217;y avez pas accès via une vue zope3.</p>
<p>Vous pouvez récupérer une liste des fonctions disponibles dans le module
<tt class="xref py py-mod docutils literal"><span class="pre">Products.CMFPlone.browser.ploneview</span></tt>.</p>
<p>Toutefois étant donné que dans Plone 4, vous n&#8217;y aurez plus accès, prenez
l&#8217;habitude d&#8217;appeler ces fonctions spéciales par l&#8217;intermédiaire d&#8217;une vue. Par
exemple au lieu d&#8217;utiliser :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;span</span> <span class="na">tal:content=</span><span class="s">&quot;python:toLocalizedTime(context.ModificationDate())&quot;</span><span class="nt">&gt;</span>
  modification date
<span class="nt">&lt;/span&gt;</span>
</pre></div>
</div>
<p>utilisez plutôt :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;span</span> <span class="na">tal:define=</span><span class="s">&quot;plone_view context/@@plone&quot;</span>
      <span class="na">tal:content=</span><span class="s">&quot;python:plone_view.toLocalizedTime(context.ModificationDate())&quot;</span><span class="nt">&gt;</span>
  modification date
<span class="nt">&lt;/span&gt;</span>
</pre></div>
</div>
<p>Les variables globales vont être supprimées dans Plone 4 pour des raisons de
performances. En effet de nombreuses variables sont accessibles depuis la
template mais ne sont pas forcément utilisées, et donc il y a un traitement
inutile au rendu de la page.</p>
<p>Vous avez quatre vues intéressantes pour récupérer des informations :</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">&#64;&#64;plone</span></tt> (toLocalizedTime...)</li>
<li><tt class="docutils literal"><span class="pre">&#64;&#64;plone_tools</span></tt> (properties pour récupérer portal_properties)</li>
<li><tt class="docutils literal"><span class="pre">&#64;&#64;plone_portal_state</span></tt> (navigation_root_url, is_locked, language,
is_editable, object_url...)</li>
<li><tt class="docutils literal"><span class="pre">&#64;&#64;plone_context_state</span></tt> (portal_url...)</li>
</ul>
</div>
<div class="section" id="presentation-des-zpt">
<h2><a class="toc-backref" href="#id15">Présentation des ZPT</a><a class="headerlink" href="#presentation-des-zpt" title="Lien permanent vers ce titre">¶</a></h2>
<p>Objectif</p>
<p>Être capable de comprendre, créer et modifier les pages dynamiques.</p>
<p>Les Zope Page Template sont un mécanisme permettant d&#8217;écrire des pages XHTML
dynamiques.</p>
<p>Elles sont constituées de page XHTML dans lesquelles sont inclus des balises et
attributs TAL/METAL.</p>
<p>Exemple :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span>
    <span class="na">xml:lang=</span><span class="s">&quot;en&quot;</span>
    <span class="na">lang=</span><span class="s">&quot;en&quot;</span>
    <span class="na">xmlns:tal=</span><span class="s">&quot;http://xml.zope.org/namespaces/tal&quot;</span>
    <span class="na">xmlns:metal=</span><span class="s">&quot;http://xml.zope.org/namespaces/metal&quot;</span>
    <span class="na">xmlns:i18n=</span><span class="s">&quot;http://xml.zope.org/namespaces/i18n&quot;</span>
    <span class="na">metal:use-macro=</span><span class="s">&quot;here/main_template/macros/master&quot;</span>
    <span class="na">i18n:domain=</span><span class="s">&quot;plone&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;head&gt;&lt;title&gt;&lt;/title&gt;&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;metal:fill</span> <span class="na">fill-slot=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;metal:main_macro</span> <span class="na">define-macro=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">tal:content=</span><span class="s">&quot;python:1+3*7&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/metal:main_macro&gt;</span>
        <span class="nt">&lt;/metal:fill&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id16">Le langage TAL</a><a class="headerlink" href="#id3" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le texte d&#8217;origine est accessible à
<a class="reference external" href="http://www.sebastien-verbois.be/plone/zpt/zpt-am">http://www.sebastien-verbois.be/plone/zpt/zpt-am</a></p>
<p>Template Attribute Language (commandes possibles)</p>
<div class="section" id="liste-des-commandes">
<h3><a class="toc-backref" href="#id17">Liste des commandes</a><a class="headerlink" href="#liste-des-commandes" title="Lien permanent vers ce titre">¶</a></h3>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">tal:content</span></tt> pour remplacer le contenu d&#8217;une balise ;</li>
<li><tt class="docutils literal"><span class="pre">tal:replace</span></tt> pour remplacer toute la balise ;</li>
<li><tt class="docutils literal"><span class="pre">tal:condition</span></tt> condition d&#8217;exécution du bloc ;</li>
<li><tt class="docutils literal"><span class="pre">tal:attributes</span></tt> pour manipuler les attributs de la balise ;</li>
<li><tt class="docutils literal"><span class="pre">tal:define</span></tt> pour définir des variables ;</li>
<li><tt class="docutils literal"><span class="pre">tal:repeat</span></tt> pour faire une boucle ;</li>
<li><tt class="docutils literal"><span class="pre">tal:omit-tag</span></tt> pour ne pas produire la balise elle-même ;</li>
<li><tt class="docutils literal"><span class="pre">tal:on-error</span></tt> pour définir le comportement en cas d&#8217;erreur.</li>
</ul>
<p><tt class="docutils literal"><span class="pre">tal:content</span></tt> et <tt class="docutils literal"><span class="pre">tal:replace</span></tt> sont mutuellement exclusives.</p>
<p>Une commande ne peut apparaître qu&#8217;une seule fois dans une balise.</p>
</div>
<div class="section" id="ordre-d-evaluation">
<h3><a class="toc-backref" href="#id18">Ordre d&#8217;évaluation</a><a class="headerlink" href="#ordre-d-evaluation" title="Lien permanent vers ce titre">¶</a></h3>
<p>define -&gt; condition -&gt; repeat -&gt; (content | replace) -&gt; attributes -&gt; omit-tag</p>
<p><tt class="docutils literal"><span class="pre">on-error</span></tt> est évalué si une exception est levée lors d&#8217;un traitement
d&#8217;une des opérations ci-dessus.</p>
</div>
<div class="section" id="content-et-replace">
<h3><a class="toc-backref" href="#id19">Content et Replace</a><a class="headerlink" href="#content-et-replace" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-xml"><div class="highlight"><pre>tal:content=&quot;[structure] Tales&quot;

tal:replace=&quot;[structure] Tales&quot;
</pre></div>
</div>
<p>Le contenu est automatiquement transformé à l&#8217;aide de la fonction html_quote.
Pour ne pas subir cette transformation, il faut utiliser le préfixe structure.</p>
<p>Il est possible d&#8217;accéder aux informations portées par les itérations en utilisant la variable repeat.</p>
</div>
<div class="section" id="condition">
<h3><a class="toc-backref" href="#id20">Condition</a><a class="headerlink" href="#condition" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-xml"><div class="highlight"><pre>tal:condition=&quot;Tales&quot;
</pre></div>
</div>
<p>Tales est évalée à True ou False.
Le nombre zéro, la chaîne vide, une liste vide et la variable <tt class="docutils literal"><span class="pre">nothing</span></tt> sont
évaluées à <tt class="docutils literal"><span class="pre">False</span></tt>.</p>
</div>
<div class="section" id="attributes">
<h3><a class="toc-backref" href="#id21">Attributes</a><a class="headerlink" href="#attributes" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-xml"><div class="highlight"><pre>tal:attributes=&quot;NomAttribut1 Tales1; NomAttribut2 Tales2; ...; NomAttributN TalesN&quot;
</pre></div>
</div>
</div>
<div class="section" id="define">
<h3><a class="toc-backref" href="#id22">Define</a><a class="headerlink" href="#define" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-xml"><div class="highlight"><pre>tal:define=&quot;[global] NomVariable1 Tales1; [global] NomVariable2 Tales2; ...; [global] NomVariableN TalesN;&quot;
</pre></div>
</div>
</div>
<div class="section" id="repeat">
<h3><a class="toc-backref" href="#id23">Repeat</a><a class="headerlink" href="#repeat" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-xml"><div class="highlight"><pre>tal:repeat=&quot;NomVariable Tales&quot;
</pre></div>
</div>
<p>Les itérations imbriquées sont possibles.</p>
<p>Les tales suivantes sont accessibles dans le bloc <tt class="docutils literal"><span class="pre">repeat</span></tt> :</p>
<ul class="simple">
<li>repeat/NomVariable/index : 0,1,...</li>
<li>repeat/NomVariable/number : 1,2,...</li>
<li>repeat/NomVariable/letter : a,b,...</li>
<li>repeat/NomVariable/Letter : A,B,...</li>
<li>repeat/NomVariable/roman : i,ii,...</li>
<li>repeat/NomVariable/Roman : I,II,...</li>
<li>repeat/NomVariable/even</li>
<li>repeat/NomVariable/odd</li>
<li>repeat/NomVariable/start</li>
<li>repeat/NomVariable/end</li>
<li>repeat/NomVariable/first</li>
<li>repeat/NomVariable/last</li>
</ul>
</div>
<div class="section" id="on-error">
<h3><a class="toc-backref" href="#id24">On-error</a><a class="headerlink" href="#on-error" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-xml"><div class="highlight"><pre>tal:on-error=&quot;Tales&quot;
</pre></div>
</div>
<p>La valeur de Tales est utilisée pour remplacer l&#8217;expression qui a levé une exception dans une autre TAL.</p>
</div>
<div class="section" id="omit-tag">
<h3><a class="toc-backref" href="#id25">Omit-tag</a><a class="headerlink" href="#omit-tag" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-xml"><div class="highlight"><pre>tal:omit-tag=&quot;&quot;
</pre></div>
</div>
</div>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id26">TALES</a><a class="headerlink" href="#id4" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="definition">
<h3><a class="toc-backref" href="#id27">Définition</a><a class="headerlink" href="#definition" title="Lien permanent vers ce titre">¶</a></h3>
<p>TAL Expression Syntax (language d&#8217;expression des opérations possibles)</p>
<div class="highlight-xml"><div class="highlight"><pre>Tales ::= [Type:]Suite

Type ::= path|string|python|not|exists|nocall
</pre></div>
</div>
<p>Si Type n&#8217;est pas donné, le type path est utilisé (type par défaut).</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">path</span></tt> permet d&#8217;accéder au rendu d&#8217;un objet ou attribut disponible
dans la pile d&#8217;acquisition de la template ;</li>
<li><tt class="docutils literal"><span class="pre">string</span></tt> permet de combiner une expression simple avec du texte ;</li>
<li><tt class="docutils literal"><span class="pre">python</span></tt> permet d&#8217;évaluer du code python ;</li>
<li><tt class="docutils literal"><span class="pre">not</span></tt> permet d&#8217;effectuer une négation sur une expression path, string ou
python ;</li>
<li><tt class="docutils literal"><span class="pre">nocall</span></tt> permet d&#8217;accéder à l&#8217;objet évalué plutôt qu&#8217;à son rendu ;</li>
<li><tt class="docutils literal"><span class="pre">exists</span></tt> permet de tester l&#8217;existence d&#8217;un attribut ou d&#8217;une méthode (même
formalisme que path).</li>
</ul>
<p><tt class="docutils literal"><span class="pre">path</span></tt>, <tt class="docutils literal"><span class="pre">nocall</span></tt> et <tt class="docutils literal"><span class="pre">exists</span></tt> sont des expressions &#8220;path&#8221;.</p>
<p>Variables implicites :</p>
<ul class="simple">
<li>attrs</li>
<li>container</li>
<li>default</li>
<li>context/here</li>
<li>modules</li>
<li>nothing</li>
<li>options</li>
<li>request</li>
<li>root</li>
<li>template</li>
<li>user</li>
</ul>
<p>Voir <a class="reference external" href="http://plone.org/documentation/tutorial/zpt/">http://plone.org/documentation/tutorial/zpt/</a> pour une description.</p>
<p>L&#8217;utilisation de here est dépréciée au profit de context.</p>
</div>
<div class="section" id="exemples">
<h3><a class="toc-backref" href="#id28">Exemples</a><a class="headerlink" href="#exemples" title="Lien permanent vers ce titre">¶</a></h3>
<div class="section" id="path">
<h4><a class="toc-backref" href="#id29">Path</a><a class="headerlink" href="#path" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>path:context/title_or_id</li>
<li>path:context/bobobase_modification_time</li>
<li>path:container/objectValues</li>
<li>path:container/objectIds</li>
<li>path:user/getUserName</li>
<li>path:request/AUTHENTICATED_USER</li>
<li>path:request/URL</li>
</ul>
</div>
<div class="section" id="path-alternatif-et-nothing">
<h4><a class="toc-backref" href="#id30">Path alternatif et nothing</a><a class="headerlink" href="#path-alternatif-et-nothing" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>path:request/form/custname | context/custname | nothing</li>
</ul>
</div>
<div class="section" id="not">
<h4><a class="toc-backref" href="#id31">Not</a><a class="headerlink" href="#not" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>not:request/maVariable</li>
</ul>
</div>
<div class="section" id="string">
<h4><a class="toc-backref" href="#id32">String</a><a class="headerlink" href="#string" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-xml"><div class="highlight"><pre>string:Quelques mots !
</pre></div>
</div>
<p>On peut utilise une expression path dans une expression string en l&#8217;encadrant
par ${}.</p>
<ul class="simple">
<li>string:Bienvenue ${user/getUserName} !</li>
<li>string:$$ 30</li>
</ul>
</div>
<div class="section" id="nocall">
<h4><a class="toc-backref" href="#id33">Nocall</a><a class="headerlink" href="#nocall" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-xml"><div class="highlight"><pre>tal:define=&quot;doc nocall:here/monDocument&quot; tal:content=&quot;string:${doc/id}: ${doc/title}&quot;
</pre></div>
</div>
</div>
<div class="section" id="python">
<h4><a class="toc-backref" href="#id34">Python</a><a class="headerlink" href="#python" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-xml"><div class="highlight"><pre>python:len(container.objectValues([&#39;File&#39;,&#39;Image&#39;]))

python:context.bobobase_modification_time.strftime(&#39;%d/%m/%Y&#39;)

python:test(nombre/2,&#39;Nombre pair&#39;,&#39;Nombre impair&#39;)

python:context.monScript(arg1,arg2)
</pre></div>
</div>
<p>Possibilité d&#8217;utiliser les autres types d&#8217;expressions au sein d&#8217;une expression
python à l&#8217;aide des fonctions path(), string(), exists(), nocall().</p>
<div class="highlight-xml"><div class="highlight"><pre>python:path(&#39;here/%s/title_or_id&#39; % currentfolder)

python:path(string(&#39;here/$foldername/thing&#39;))

python:path(&#39;request/form/x&#39;) or default
</pre></div>
</div>
<p>Accéder à des objets zope</p>
<div class="highlight-xml"><div class="highlight"><pre>python:getattr(here,&#39;penguin.gif&#39;) (== path:here/penguin.gif)

python:request[&#39;URL&#39;] (== path:request/URL)

python:request.form[&#39;x&#39;] (== path:request/form/x)

python:modules[&#39;math&#39;]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id35">METAL</a><a class="headerlink" href="#id5" title="Lien permanent vers ce titre">¶</a></h2>
<p>Macro Expansion Template Attribute Language (système de macros)</p>
<div class="highlight-xml"><div class="highlight"><pre>metal:define-macro

metal:define-slot

metal:use-macro

metal:fill-slot
</pre></div>
</div>
<div class="section" id="metal-define-macro">
<h3><a class="toc-backref" href="#id36">metal:define-macro</a><a class="headerlink" href="#metal-define-macro" title="Lien permanent vers ce titre">¶</a></h3>
<p>Permet de définir une macro que l&#8217;on pourra appeler par <tt class="docutils literal"><span class="pre">metal=use-macro</span></tt>.</p>
</div>
<div class="section" id="metal-define-slot">
<h3><a class="toc-backref" href="#id37">metal:define-slot</a><a class="headerlink" href="#metal-define-slot" title="Lien permanent vers ce titre">¶</a></h3>
<p>Permet de définir un connecteur dans une macro qui permettra d&#8217;insérer du code
lors de l&#8217;expansion de la macro.</p>
</div>
<div class="section" id="metal-use-macro">
<h3><a class="toc-backref" href="#id38">metal:use-macro</a><a class="headerlink" href="#metal-use-macro" title="Lien permanent vers ce titre">¶</a></h3>
<p>Permet d&#8217;indiquer que l&#8217;on souhaite utiliser une macro définie dans une ZPT.</p>
<p>Ainsi <tt class="docutils literal"><span class="pre">&lt;div</span> <span class="pre">metal:use-macro=&quot;here/main_template/macros/master&quot;&gt;</span></tt> va
chercher la macro master définie dans la ZPT main_template.</p>
</div>
<div class="section" id="metal-fill-slot">
<h3><a class="toc-backref" href="#id39">metal:fill-slot</a><a class="headerlink" href="#metal-fill-slot" title="Lien permanent vers ce titre">¶</a></h3>
<p>Permet d&#8217;insérer du XHTML dans l&#8217;espace prévue pour cela dans une macro.</p>
<p>Ainsi <tt class="docutils literal"><span class="pre">&lt;metal:fill</span> <span class="pre">fill-slot=&quot;main&quot;&gt;Mon</span> <span class="pre">contenu&lt;/metal:fill&gt;</span></tt> permet d&#8217;insérer
&#8220;Mon contenu&#8221; dans la partie <tt class="docutils literal"><span class="pre">metal:define-slot=&quot;main&quot;</span></tt> de la zpt appelée par
metal-use-macro.</p>
<div class="section" id="tips">
<h4><a class="toc-backref" href="#id40">Tips</a><a class="headerlink" href="#tips" title="Lien permanent vers ce titre">¶</a></h4>
<p>Utiliser default</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;p</span> <span class="na">tal:content=</span><span class="s">&quot;request/form/info | default&quot;</span><span class="nt">&gt;</span>Pas de variable &quot;info&quot; dans la requête.<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div>
<p>Afficher du texte dans la template qui ne sera pas rendu par la suite</p>
<div class="highlight-xml"><div class="highlight"><pre>tal:replace=&quot;nothing&quot;
</pre></div>
</div>
<p>Choisir la classe d&#8217;une entité</p>
<div class="highlight-xml"><div class="highlight"><pre>tal:attributes=&quot;class python:test(...,&#39;selected&#39;,&#39;plain&#39;)&quot;
</pre></div>
</div>
<p>Utilisation d&#8217;un dictionnaire dans les expressions path</p>
<p><tt class="docutils literal"><span class="pre">getPerson</span></tt> est une fonction python qui renvoie le dictionnaire
<tt class="docutils literal"><span class="pre">{'name':</span> <span class="pre">'Toto',</span> <span class="pre">'age':</span> <span class="pre">8}</span></tt>.</p>
<p>Accéder à des modules python</p>
<div class="highlight-xml"><div class="highlight"><pre>tal:define=&quot;global mstring modules/string&quot; tal:replace=&quot;python:mstring.join(slist, &#39;:&#39;)&quot;
</pre></div>
</div>
<p>Module &#8220;PythonScripts&#8221; de Zope</p>
<div class="highlight-xml"><div class="highlight"><pre>tal:define=&quot;pps modules/Products.PythonScripts.standard&quot;
</pre></div>
</div>
<p>Gérer une exception</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;p&gt;</span>Le prix de l&#39;article est <span class="nt">&lt;b</span> <span class="na">tal:content=</span><span class="s">&quot;context/prix&quot;</span> <span class="na">tal:on-error=</span><span class="s">&quot;string:N/A&quot;</span><span class="nt">&gt;</span>0.00<span class="nt">&lt;/b&gt;</span> Euros.<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="exercice">
<h2><a class="toc-backref" href="#id41">Exercice</a><a class="headerlink" href="#exercice" title="Lien permanent vers ce titre">¶</a></h2>
<ul class="simple">
<li>Customisation de la template model9 de PloneArticle pour supprimer &#8220;ajouter
images&#8221; et &#8220;ajouter liens&#8221;.</li>
</ul>
<p>From Raphael Ritz at
<a class="reference external" href="http://n2.nabble.com/where-do-I-find-the-view-template-to-edit-a-page-%28plone-3.2%29-tp2975276p2979777.html">http://n2.nabble.com/where-do-I-find-the-view-template-to-edit-a-page-%28plone-3.2%29-tp2975276p2979777.html</a> :</p>
<p><tt class="docutils literal"><span class="pre">atct_edit</span></tt> is just a wrapper around <tt class="docutils literal"><span class="pre">base_edit</span></tt> (or whatever gets called
from <tt class="docutils literal"><span class="pre">base_edit</span></tt>) to allow for atct specific form controller settings without
interfering with Archetypes proper.  <tt class="docutils literal"><span class="pre">base_edit</span></tt> in turn pulls in the macros
from <tt class="docutils literal"><span class="pre">edit_macros</span></tt> (in the <tt class="docutils literal"><span class="pre">archetypes</span></tt> skin layer) unless you (or someone)
provides any of those macros specifically (like via a <tt class="docutils literal"><span class="pre">&lt;type_name&gt;_view/edit</span></tt>
template).</p>
<p><a class="reference external" href="http://www.llakomy.com/articles/new-submit-button-for-archetypes-edit-template">http://www.llakomy.com/articles/new-submit-button-for-archetypes-edit-template</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table des matières</a></h3>
  <ul>
<li><a class="reference internal" href="#">TAL/Metal les templates de Zope et Plone</a><ul>
<li><a class="reference internal" href="#le-langage-tal">Le langage TAL</a><ul>
<li><a class="reference internal" href="#savoir">Savoir</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tales">TALES</a><ul>
<li><a class="reference internal" href="#id1">Savoir</a></li>
</ul>
</li>
<li><a class="reference internal" href="#metal">METAL</a><ul>
<li><a class="reference internal" href="#id2">Savoir</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ressources">Ressources</a></li>
<li><a class="reference internal" href="#namespaces">Namespaces</a></li>
<li><a class="reference internal" href="#variables-globales">Variables globales</a></li>
<li><a class="reference internal" href="#presentation-des-zpt">Présentation des ZPT</a></li>
<li><a class="reference internal" href="#id3">Le langage TAL</a><ul>
<li><a class="reference internal" href="#liste-des-commandes">Liste des commandes</a></li>
<li><a class="reference internal" href="#ordre-d-evaluation">Ordre d&#8217;évaluation</a></li>
<li><a class="reference internal" href="#content-et-replace">Content et Replace</a></li>
<li><a class="reference internal" href="#condition">Condition</a></li>
<li><a class="reference internal" href="#attributes">Attributes</a></li>
<li><a class="reference internal" href="#define">Define</a></li>
<li><a class="reference internal" href="#repeat">Repeat</a></li>
<li><a class="reference internal" href="#on-error">On-error</a></li>
<li><a class="reference internal" href="#omit-tag">Omit-tag</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id4">TALES</a><ul>
<li><a class="reference internal" href="#definition">Définition</a></li>
<li><a class="reference internal" href="#exemples">Exemples</a><ul>
<li><a class="reference internal" href="#path">Path</a></li>
<li><a class="reference internal" href="#path-alternatif-et-nothing">Path alternatif et nothing</a></li>
<li><a class="reference internal" href="#not">Not</a></li>
<li><a class="reference internal" href="#string">String</a></li>
<li><a class="reference internal" href="#nocall">Nocall</a></li>
<li><a class="reference internal" href="#python">Python</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id5">METAL</a><ul>
<li><a class="reference internal" href="#metal-define-macro">metal:define-macro</a></li>
<li><a class="reference internal" href="#metal-define-slot">metal:define-slot</a></li>
<li><a class="reference internal" href="#metal-use-macro">metal:use-macro</a></li>
<li><a class="reference internal" href="#metal-fill-slot">metal:fill-slot</a><ul>
<li><a class="reference internal" href="#tips">Tips</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#exercice">Exercice</a></li>
</ul>
</li>
</ul>

  <h4>Sujet précédent</h4>
  <p class="topless"><a href="ploneformgen/index.html"
                        title="Chapitre précédent">PloneFormGen</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="workflows-locaux.html"
                        title="Chapitre suivant">Paramétrage local des workflows</a></p>
  <h3>Cette page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/formation_tal_metal.txt"
           rel="nofollow">Montrer la source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Recherche rapide</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Saisissez un mot clef ou un nom de module, classe ou fonction.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="workflows-locaux.html" title="Paramétrage local des workflows"
             >suivant</a> |</li>
        <li class="right" >
          <a href="ploneformgen/index.html" title="PloneFormGen"
             >précédent</a> |</li>
        <li><a href="index.html">Formation Plone</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010-2013, Communauté Plone francophone.
      Mis à jour le  07-February-2013.
      Créé avec <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>