

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Création d&#39;un thème Plone &mdash; Plone pour les développeurs 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Recherchez dans Plone pour les développeurs 1.0.0 documentation"
          href="_static/opensearch.xml"/>
    <link rel="top" title="Plone pour les développeurs 1.0.0 documentation" href="index.html" />
    <link rel="next" title="Les viewlets" href="viewlets.html" />
    <link rel="prev" title="Nouvelles fonctionnalités de ArchGenXML" href="nouvelles_fonctionnalites_archgenxml.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="viewlets.html" title="Les viewlets"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="nouvelles_fonctionnalites_archgenxml.html" title="Nouvelles fonctionnalités de ArchGenXML"
             accesskey="P">précédent</a> |</li>
        <li><a href="index.html">Formation Plone</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="creation-d-un-theme-plone">
<span id="creation-theme"></span><h1>Création d'un thème Plone<a class="headerlink" href="#creation-d-un-theme-plone" title="Lien permanent vers ce titre">¶</a></h1>
<p>Ajout de nouveaux composants visuels à Plone.</p>
<div class="section" id="installation-de-gloworm">
<h2>Installation de Gloworm<a class="headerlink" href="#installation-de-gloworm" title="Lien permanent vers ce titre">¶</a></h2>
<p>Gloworm est un outil pour introspecter les viewlets d'une page Plone,
très utile pour savoir comment customiser telle partie de la page.</p>
<p>Gloworm est une interface alternative à portal_skins/custom et
portal_view_customizations. On peut cliquer sur l'endroit que l'on veut
customiser et cliquer sur customiser. Le produit ne fonctionne pas avec Plone
4. Un produit qui le remplace sur Plone 4 est probablement
<em>plone.app.themeeditor</em>.</p>
<p>Créez un fichier <tt class="file docutils literal"><span class="pre">development.cfg</span></tt> :</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="k">[buildout]</span>
<span class="na">extends</span> <span class="o">=</span> <span class="s">buildout.cfg</span>

<span class="k">[instance]</span>
<span class="na">eggs +</span><span class="o">=</span><span class="s"></span>
<span class="s">    Products.Gloworm</span>
</pre></div>
</div>
<p>Reexécutez <strong class="command">bin/buildout -c development.cfg</strong>.</p>
</div>
<div class="section" id="creation-d-un-theme">
<h2>Création d'un theme<a class="headerlink" href="#creation-d-un-theme" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans le dossier <tt class="file docutils literal"><span class="pre">src/</span></tt>, créez un theme avec la commande :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> /tmp
<span class="nv">$ </span>paster create -t plone3_theme formation.theme <span class="se">\</span>
  --svn-repository<span class="o">=</span>http://devagile/Formation/packages
Skin Name : Formation Theme
Empty Styles? : False
Include Documentation? : True
<span class="nv">$ </span>svn rm --force formation.theme/formation.theme.egg-info <span class="se">\</span>
  formation.theme-configure.zcml
  formation/theme/skins/formation_theme_styles/base.css.dtml <span class="se">\</span>
  formation/theme/skins/formation_theme_styles/portlets.css.dtml <span class="se">\</span>
  formation/theme/skins/formation_theme_styles/public.css.dtml <span class="se">\</span>
  formation/theme/version.txt
  formation/theme/skins/formation_theme_styles/base_properties.props
</pre></div>
</div>
<p><tt class="file docutils literal"><span class="pre">base_properties.props</span></tt> n'est plus utilisé dans Plone 4.</p>
<p>Éditez <tt class="file docutils literal"><span class="pre">setup.py</span></tt> pour supprimer les deux lignes :</p>
<div class="highlight-py"><div class="highlight"><pre><span class="n">setup_requires</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;PasteScript&quot;</span><span class="p">],</span>
<span class="n">paster_plugins</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;ZopeSkel&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Éditez <tt class="file docutils literal"><span class="pre">formation/theme/profiles/default/skins.xml</span></tt> pour remplacer
<em>based-on=&quot;Plone Default&quot;</em> par <em>based-on=&quot;Sunburst Theme&quot;</em>.</p>
<p>Et commitez :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>svn ci -m<span class="s2">&quot;Initial theme structure&quot;</span>
</pre></div>
</div>
<p>Retournez dans votre buildout, ajoutez <tt class="xref py py-mod docutils literal"><span class="pre">formation.theme</span></tt> dans auto-checkout du
fichier <tt class="file docutils literal"><span class="pre">sources.cfg</span></tt>, ainsi que dans <em>eggs</em> de la section <em>[instance]</em>
de <tt class="file docutils literal"><span class="pre">buildout.cfg</span></tt>, commitez et relancez le buildout.</p>
</div>
<div class="section" id="exercice-1">
<h2>Exercice 1<a class="headerlink" href="#exercice-1" title="Lien permanent vers ce titre">¶</a></h2>
<p>Changer la couleur des documents dans l'état &quot;En attente de modération&quot; (pending).
Utilisez l'extension Firebug de firefox pour récupérer la règle css utilisé par défaut pour colorisé le lien en orange. Copiez ensuite cette règle dans browser/stylesheets/main.css et changez la couleur :</p>
<div class="highlight-css"><div class="highlight"><pre><span class="nc">.state-pending</span> <span class="p">{</span>
    <span class="k">color</span><span class="o">:</span><span class="m">#FFA5FF</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Passez portal_css en mode debug comme ça vous ne devrez pas redémarrer l'instance à chaque fois que vous modifiez les css.</p>
</div>
<div class="section" id="exercice-2-creation-d-une-viewlet">
<h2>Exercice 2 : Création d'une viewlet<a class="headerlink" href="#exercice-2-creation-d-une-viewlet" title="Lien permanent vers ce titre">¶</a></h2>
<p>Créez une viewlet affichant une image dans le footer.</p>
<p>Référez-vous au chapitre <a class="reference internal" href="viewlets.html#viewlets"><em>Les viewlets</em></a> pour consulter la documentation complète sur cette notion.</p>
<div class="section" id="ajouter-une-image">
<h3>Ajouter une image<a class="headerlink" href="#ajouter-une-image" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ajoutez une image dans le dossier <tt class="file docutils literal"><span class="pre">browser/images/</span></tt>.
Pour accéder ensuite à l'image, vous devez utiliser le nom de la
resourceDirectory : <em>++resource++formation.theme.images</em>, suivit de <em>/</em> et du
nom de votre image dans le dossier images.
Exemple : ++resource++formation.theme.images/monimage.png</p>
<p>Éditez le fichier <tt class="file docutils literal"><span class="pre">browser/viewlets.py</span></tt>, décommentez la classe, nommez
la <em>LogoViewlet</em>. Copiez le fichier <tt class="file docutils literal"><span class="pre">viewlet.pt</span></tt> en
<tt class="file docutils literal"><span class="pre">logoviewlet.pt</span></tt>.</p>
<p>Contenu du fichier logoviewlet.pt :</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;img</span> <span class="na">tal:define=</span><span class="s">&quot;portal_state context/@@plone_portal_state;</span>
<span class="s">                 root_url portal_state/portal_url&quot;</span>
     <span class="na">tal:attributes=</span><span class="s">&quot;src string:$root_url/++resource++formation.theme.images/image.png&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Éditez le fichier <tt class="file docutils literal"><span class="pre">configure.zcml</span></tt> pour déclarer votre viewlet.
Vous avez un exemple en commentaire. Il suffit de le décommenter et d'ajuster
le nom de la viewlet et la classe. Cela donne :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;browser:viewlet</span>
    <span class="na">name=</span><span class="s">&quot;formation.logoviewlet&quot;</span>
    <span class="na">manager=</span><span class="s">&quot;plone.app.layout.viewlets.interfaces.IPortalFooter&quot;</span>
    <span class="na">class=</span><span class="s">&quot;.viewlets.LogoViewlet&quot;</span>
    <span class="na">layer=</span><span class="s">&quot;.interfaces.IThemeSpecific&quot;</span>
    <span class="na">permission=</span><span class="s">&quot;zope2.View&quot;</span>
    <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Maintenant au lieu d'afficher votre LogoViewlet dans le PortalFooter,
vous allez l'afficher dans portalheader en précisant que vous le voulez après le logo de plone.
Dans configure.zcml, changez l'interface du viewletmanager en IPortalHeader :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;browser:viewlet</span>
    <span class="na">name=</span><span class="s">&quot;formation.logoviewlet&quot;</span>
    <span class="na">manager=</span><span class="s">&quot;plone.app.layout.viewlets.interfaces.IPortalHeader&quot;</span>
    <span class="na">class=</span><span class="s">&quot;.viewlets.LogoViewlet&quot;</span>
    <span class="na">layer=</span><span class="s">&quot;.interfaces.IThemeSpecific&quot;</span>
    <span class="na">permission=</span><span class="s">&quot;zope2.View&quot;</span>
    <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Éditez ensuite <tt class="file docutils literal"><span class="pre">profiles/default/viewlets.xml</span></tt> :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;object&gt;</span>
  <span class="nt">&lt;order</span> <span class="na">manager=</span><span class="s">&quot;plone.portalheader&quot;</span> <span class="na">skinname=</span><span class="s">&quot;formation&#39;s theme&quot;</span>
         <span class="na">based-on=</span><span class="s">&quot;Plone Default&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;viewlet</span> <span class="na">name=</span><span class="s">&quot;zdevan.logoviewlet&quot;</span>
             <span class="na">insert-after=</span><span class="s">&quot;plone.logo&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/order&gt;</span>
<span class="nt">&lt;/object&gt;</span>
</pre></div>
</div>
<p>Relancez l'instance et réinstallez votre produit pour prendre en compte le changement.</p>
</div>
</div>
<div class="section" id="portlets">
<h2>Portlets<a class="headerlink" href="#portlets" title="Lien permanent vers ce titre">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://plone.org/documentation/manual/portlets-developer-manual">http://plone.org/documentation/manual/portlets-developer-manual</a></li>
</ul>
<p>Créez le portlet :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> /tmp
<span class="nv">$ </span>paster create -t plone3_portlet formation.portlet.docinfo <span class="se">\</span>
  --svn-repository<span class="o">=</span>http://devagile/Formation/packages
</pre></div>
</div>
<ul class="simple">
<li>Supprimez le répertoire egg-info, le fichier version.txt</li>
<li>Ajoutez ensuite l'entry point z3c.autoinclude.plugin dans setup.py</li>
<li>Commitez</li>
<li>Ajoutez ce nouveau egg dans votre buildout.cfg et sources.cfg</li>
<li>Relancez le buildout</li>
<li>Commitez les changements fait dans le buildout</li>
</ul>
<p>Démarrez l'instance, installez le produit et ajoutez le portlet.</p>
<p>Éditez le fichier <tt class="file docutils literal"><span class="pre">docinfoportlet.py</span></tt> et ajoutez un champ informations au schema IDocInfoPortlet :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">informations</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Information list&quot;</span><span class="p">),</span>
                       <span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;A list of information about the document&quot;</span><span class="p">),</span>
                       <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                       <span class="n">value_type</span><span class="o">=</span><span class="n">schema</span><span class="o">.</span><span class="n">Choice</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;Creator&#39;</span><span class="p">,</span><span class="s">&#39;effective&#39;</span><span class="p">))</span>
                       <span class="p">)</span>
</pre></div>
</div>
<p>Modifiez également l'implémentation :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Assignment</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Assignment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Portlet assignment.</span>

<span class="sd">    This is what is actually managed through the portlets UI and associated</span>
<span class="sd">    with columns.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">implements</span><span class="p">(</span><span class="n">IDocInfoPortlet</span><span class="p">)</span>

    <span class="n">informations</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">informations</span><span class="o">=</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">informations</span> <span class="o">=</span> <span class="n">informations</span>
</pre></div>
</div>
<p>Dans la template, afficher les informations qui ont été choisies via le formulaire du portlet :</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;dl</span> <span class="na">class=</span><span class="s">&quot;portlet portletDocInfoPortlet&quot;</span>
    <span class="na">i18n:domain=</span><span class="s">&quot;formation.portlet.docinfo&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;dt</span> <span class="na">class=</span><span class="s">&quot;portletHeader&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;portletTopLeft&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
        Information
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;portletTopRight&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/dt&gt;</span>

    <span class="nt">&lt;dd</span> <span class="na">class=</span><span class="s">&quot;portletItem odd&quot;</span> <span class="na">tal:define=</span><span class="s">&quot;informations view/data/informations;</span>
<span class="s">                                            plone_view context/@@plone;</span>
<span class="s">                                            mtool context/portal_membership&quot;</span> <span class="nt">&gt;</span>

        <span class="nt">&lt;strong&gt;</span>Created by :<span class="nt">&lt;/strong&gt;</span>

        <span class="nt">&lt;span</span> <span class="na">tal:condition=</span><span class="s">&quot;python:&#39;Creator&#39; in informations&quot;</span>
              <span class="na">tal:replace=</span><span class="s">&quot;python:mtool.getMemberById(context.Creator()).getProperty(&#39;fullname&#39;,context.Creator())&quot;</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;strong&gt;</span>Date of creation :<span class="nt">&lt;/strong&gt;</span>

        <span class="nt">&lt;span</span> <span class="na">i18n:translate=</span><span class="s">&quot;text_effective_date&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">tal:condition=</span><span class="s">&quot;python:&#39;effective&#39; in informations&quot;</span>
              <span class="na">tal:content=</span><span class="s">&quot;python:plone_view.toLocalizedTime(context.effective())&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/span&gt;</span>

        <span class="nt">&lt;tal:block</span> <span class="na">condition=</span><span class="s">&quot;python:&#39;ExpirationDate&#39; in informations&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">i18n:translate=</span><span class="s">&quot;text_expiration_date&quot;</span>
                <span class="na">tal:condition=</span><span class="s">&quot;context/ExpirationDate&quot;</span><span class="nt">&gt;</span>

            <span class="nt">&lt;strong&gt;</span>Expiration :<span class="nt">&lt;/strong&gt;</span>

            <span class="nt">&lt;span</span> <span class="na">i18n:name=</span><span class="s">&quot;date&quot;</span>
                  <span class="na">tal:content=</span><span class="s">&quot;python:plone_view.toLocalizedTime(context.ExpirationDate())&quot;</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;/tal:block&gt;</span>
    <span class="nt">&lt;/dd&gt;</span>

<span class="nt">&lt;/dl&gt;</span>
</pre></div>
</div>
<p>Ajoutez une property <em>available</em> dans la classe Renderer pour afficher le portlet seulement pour les documents :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Renderer</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Renderer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Portlet renderer.</span>

<span class="sd">    This is registered in configure.zcml. The referenced page template is</span>
<span class="sd">    rendered, and the implicit variable &#39;view&#39; will refer to an instance</span>
<span class="sd">    of this class. Other methods can be added and referenced in the template.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">meta_type</span> <span class="o">==</span> <span class="s">&quot;ATDocument&quot;</span>

    <span class="n">render</span> <span class="o">=</span> <span class="n">ViewPageTemplateFile</span><span class="p">(</span><span class="s">&#39;docinfoportlet.pt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="genericsetup">
<h2>GenericSetup<a class="headerlink" href="#genericsetup" title="Lien permanent vers ce titre">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://plone.org/documentation/tutorial/genericsetup">http://plone.org/documentation/tutorial/genericsetup</a></li>
<li><a class="reference external" href="http://www.sixfeetup.com/swag/generic-setup-quick-reference-card">http://www.sixfeetup.com/swag/generic-setup-quick-reference-card</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table des matières</a></h3>
  <ul>
<li><a class="reference internal" href="#">Création d'un thème Plone</a><ul>
<li><a class="reference internal" href="#installation-de-gloworm">Installation de Gloworm</a></li>
<li><a class="reference internal" href="#creation-d-un-theme">Création d'un theme</a></li>
<li><a class="reference internal" href="#exercice-1">Exercice 1</a></li>
<li><a class="reference internal" href="#exercice-2-creation-d-une-viewlet">Exercice 2 : Création d'une viewlet</a><ul>
<li><a class="reference internal" href="#ajouter-une-image">Ajouter une image</a></li>
</ul>
</li>
<li><a class="reference internal" href="#portlets">Portlets</a></li>
<li><a class="reference internal" href="#genericsetup">GenericSetup</a></li>
</ul>
</li>
</ul>

  <h4>Sujet précédent</h4>
  <p class="topless"><a href="nouvelles_fonctionnalites_archgenxml.html"
                        title="Chapitre précédent">Nouvelles fonctionnalités de ArchGenXML</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="viewlets.html"
                        title="Chapitre suivant">Les viewlets</a></p>
  <h3>Cette page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/creation_theme.txt"
           rel="nofollow">Montrer la source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Recherche rapide</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Saisissez un mot clef ou un nom de module, classe ou fonction.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="viewlets.html" title="Les viewlets"
             >suivant</a> |</li>
        <li class="right" >
          <a href="nouvelles_fonctionnalites_archgenxml.html" title="Nouvelles fonctionnalités de ArchGenXML"
             >précédent</a> |</li>
        <li><a href="index.html">Formation Plone</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010-2013, Communauté Plone francophone.
      Mis à jour le  07-February-2013.
      Créé avec <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>