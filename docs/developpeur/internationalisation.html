
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Internationalisation d&#39;un composant &mdash; Plone pour les développeurs 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/plone.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Recherchez dans Plone pour les développeurs 1.0.0 documentation"
          href="_static/opensearch.xml"/>
    <link rel="top" title="Plone pour les développeurs 1.0.0 documentation" href="index.html" />
    <link rel="next" title="Gestion des utilisateurs avec PlonePAS" href="plonepas/index.html" />
    <link rel="prev" title="La vue &#34;plone&#34;" href="vues_standard/plone.html" />
<script language="javascript">
//<![CDATA[

Documentation.addTranslations({"locale": "fr", "plural_expr": "(n > 1)", "messages": {"See the definition": "Voir la d\u00e9finition"}});

// See http://disqus.disqus.com/general_integration_help/
var disqus_developer = 1;
if (document.location.protocol == 'http:') {
    disqus_developer = 0;
}

// Some HTML/CSS transforms we can't do in pure CSS (waiting for CSS3 support)
$(document).ready(function () {

    // Style of .. verisonmodified:: , .. versionadded:: ...
    $('p:has(span.versionmodified)').addClass('p-versionmodified');

    // Style of the TOC tree
    $('ul:has(li.toctree-l1)').addClass('toctree');

    // Decorate links to other sites
    $('a[class~=external]').attr('target', '_blank');

    // Glossary terms
    $('em.xref').attr('title', _('See the definition'));

    // We need to have all <pre> in a <div class="highlight"> to mimic pygments
    // to work around a pygments (?) bug
    var suffixes = {cfg: null, python:null};
    for (var suffix in suffixes) {
        var pattern = 'div.highlight-' + suffix + ' > pre';
        $(pattern).wrap('<div class="highlight" />');
    }
    return true;
});
//]]>
</script>

  </head>
  <body>
<!--[if lte IE 6]>
<style type="text/css">
#ie6msg{border:3px solid #090; margin:8px 0; background:#cfc; color:#000;}
#ie6msg h4{margin:8px; padding:0;}
#ie6msg p{margin:8px; padding:0;}
#ie6msg p a.getie8{font-weight:bold; color:#006;}
#ie6msg p a.ie6expl{font-weight:normal; color:#006;}
</style>
<div id="ie6msg">
<h4>Did you know that your browser is out of date?</h4>
<p>If the layout of this site seems ugly, that's because you're actually using
an outdated browser. And we wont put any effort to provide a nice layout to IE6
users.</p>
<p>To get the best possible experience using our website we recommend that you
upgrade your browser to a newer version. The current version
is <a class="getie8"
href="http://upgradeie.s3.amazonaws.com/eng/index.html">Internet Explorer
8</a>. The upgrade is free. If you're using a PC at work you should contact your
IT administrator.</p>
<p>If you want to you may also try some other popular Internet browsers
like <a class="ie6expl"
href="http://getfirefox.com">Firefox</a>, <a class="ie6expl"
href="http://www.google.com/chrome">Chrome</a>, <a class="ie6expl"
href="http://www.opera.com">Opera</a>, or <a class="ie6expl"
href="http://www.apple.com/safari/download/">Safari</a></p>
</div>
<![endif]-->

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="plonepas/index.html" title="Gestion des utilisateurs avec PlonePAS"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="vues_standard/plone.html" title="La vue &#34;plone&#34;"
             accesskey="P">précédent</a> |</li>
        <li><a href="index.html">Formation Plone</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="internationalisation-d-un-composant">
<span id="internationalisation"></span><h1>Internationalisation d'un composant<a class="headerlink" href="#internationalisation-d-un-composant" title="Lien permanent vers ce titre">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Vincent Fretin</td>
</tr>
<tr class="field-even field"><th class="field-name">Version:</th><td class="field-body">1.0.0</td>
</tr>
<tr class="field-odd field"><th class="field-name">Contributors:</th><td class="field-body">Thomas Desvenain</td>
</tr>
<tr class="field-even field"><th class="field-name">Révision:</th><td class="field-body"><a class="reference external" href="https://svn.plone.org/svn/collective/collective.trainingmanual/trunk/fr/developpeur/source/internationalisation.txt">https://svn.plone.org/svn/collective/collective.trainingmanual/trunk/fr/developpeur/source/internationalisation.txt</a></td>
</tr>
</tbody>
</table>
<p>Copyright (C) 2010, Vincent Fretin &lt;vincentfretin AT gmail.com&gt;.</p>
<p>Plone est multilingue. Cette partie explique comment rendre votre composant
disponible en plusieurs langues.</p>
<div class="admonition-internationalisation-et-localisation admonition">
<p class="first admonition-title">Internationalisation et localisation</p>
<p class="last">Nous distinguerons l'<strong>internationalisation</strong> (<a class="reference internal" href="glossaire.html#term-i18n"><em class="xref std std-term">i18n</em></a>), qui consiste à
utiliser l'API de production de textes dans le code Python et les templates,
de la <strong>localisation</strong> (<a class="reference internal" href="glossaire.html#term-l10n"><em class="xref std std-term">l10n</em></a>), qui consiste à fournir la traduction
des labels produits lors de l'internationalisation.</p>
</div>
<div class="section" id="exemples-de-la-formation">
<h2>Exemples de la formation<a class="headerlink" href="#exemples-de-la-formation" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les exemples de cette formation sont dans le package collective.trainingmanual.i18nexamples.
Pour l'installer, ajoutez à votre buildout :</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="k">[buildout]</span>
<span class="na">eggs +</span><span class="o">=</span><span class="s"></span>
<span class="s">    # ...</span>
<span class="s">    collective.trainingmanual.i18nexamples</span>

<span class="na">auto-checkout +</span><span class="o">=</span><span class="s"></span>
<span class="s">    # ...</span>
<span class="s">    collective.trainingmanual.i18nexamples</span>

<span class="k">[instance]</span>
<span class="na">zcml +</span><span class="o">=</span><span class="s"></span>
<span class="s">    # ...</span>
<span class="s">    collective.trainingmanual.i18nexamples</span>

<span class="k">[sources]</span>
<span class="na">collective.trainingmanual.i18nexamples</span> <span class="o">=</span> <span class="s">svn https://svn.plone.org/svn/collective/collective.trainingmanual/trunk/fr/examples/collective.trainingmanual.i18nexamples</span>
</pre></div>
</div>
<p>Vous pourrez observer les exemples de cette formation en allant à l'adresse
/i18nexamples depuis la racine de votre site.</p>
</div>
<div class="section" id="internationaliser-un-composant">
<h2>Internationaliser un composant<a class="headerlink" href="#internationaliser-un-composant" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="connaissances-requises">
<h3>Connaissances requises<a class="headerlink" href="#connaissances-requises" title="Lien permanent vers ce titre">¶</a></h3>
<p>Nous recommandons aux lecteurs de prendre préalablement connaissance des
mécanismes standards d'internationalisation des applications, basé sur le
standard &quot;GNU-gettext&quot; <a class="reference external" href="http://fr.wikipedia.org/wiki/Gettext">http://fr.wikipedia.org/wiki/Gettext</a></p>
<p>Les amateurs de détails pourront se reporter à la documentation complète en
anglais ici : <a class="reference external" href="http://www.gnu.org/software/gettext/manual/gettext.html">http://www.gnu.org/software/gettext/manual/gettext.html</a></p>
</div>
<div class="section" id="notion-de-domaine">
<h3>Notion de domaine<a class="headerlink" href="#notion-de-domaine" title="Lien permanent vers ce titre">¶</a></h3>
<p>Plone et plus généralement Zope (puisque nous parlons d'internationalisation
Zope) sont des écosystèmes générant des centaines de composants d'extension sur
l'utilité desquels nous ne reviendrons pas ici. Un intégrateur est susceptible
de mixer nombre de ces composants.</p>
<p>Ceci risque donc d'amener nombre de conflits de labels, le même label pouvant
être traduit différemment selon l'emploi qui en est fait.</p>
<p>Pour éviter ceci, le standard &quot;gettext&quot; définit la notion de &quot;domaine&quot; qui
est un espace de nommage pour les traductions de labels. Ainsi le label &quot;foo&quot;
peut être traduit différemment dans autant de domaines distincts.</p>
<p>Dès lors qu'un composant propose une interface utilisateurs comportant du texte,
il doit déclarer son domaine et le répertoire racine des traductions
(traditionnellement, le répertoire <tt class="file docutils literal"><span class="pre">locales/</span></tt> de votre egg). Vous allez
donc ajouter au fichier <tt class="file docutils literal"><span class="pre">configure.zcml</span></tt> principal de votre composant les
ligne suivantes :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;configure</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://namespaces.zope.org/zope&quot;</span>
    <span class="na">xmlns:i18n=</span><span class="s">&quot;http://namespaces.zope.org/i18n&quot;</span>
    <span class="na">i18n_domain=</span><span class="s">&quot;i18nexamples&quot;</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;i18n:registerTranslations</span> <span class="na">directory=</span><span class="s">&quot;locales&quot;</span> <span class="nt">/&gt;</span>
    ...
<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="code-python">
<h3>Code Python<a class="headerlink" href="#code-python" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous placez ensuite dans le <tt class="file docutils literal"><span class="pre">__init__.py</span></tt> principal de votre composant les
lignes suivantes :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">zope.i18nmessageid</span> <span class="kn">import</span> <span class="n">MessageFactory</span>
<span class="n">MyMessageFactory</span> <span class="o">=</span> <span class="n">MessageFactory</span><span class="p">(</span><span class="s">&#39;i18nexamples&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-ecrit-en-c admonition">
<p class="first admonition-title">Écrit en C</p>
<p class="last">Afin d'optimiser les performances, les primitives des <tt class="xref py py-class docutils literal"><span class="pre">MessageFactory</span></tt>
sont écrites en C.</p>
</div>
<p>Lorsque vous voulez placer un texte susceptible d'être traduit dans votre code,
vous devez procéder ainsi.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">collective.trainingmanual.i18nexamples</span> <span class="kn">import</span> <span class="n">MyMessageFactory</span> <span class="k">as</span> <span class="n">_</span>
<span class="c"># ...</span>
<span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="n">bar</span><span class="p">):</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;my_message&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">u&quot;Some words&quot;</span><span class="p">)</span>
    <span class="c"># ...</span>
</pre></div>
</div>
<div class="sidebar">
<p class="first sidebar-title">Utiliser les labels du domaine &quot;plone&quot;</p>
<p>Pour des raisons de cohérence globale de votre site, il est recommandé, dans la
mesure du possible de reprendre les traductions déjà fournies par Plone. Pour
effectuer ceci dans du code Python :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Products.CMFPlone</span> <span class="kn">import</span> <span class="n">PloneMessageFactory</span> <span class="k">as</span> <span class="n">PMF</span>
<span class="c"># ...</span>
<span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">PMF</span><span class="p">(</span><span class="s">u&#39;Save&#39;</span><span class="p">)</span> <span class="c"># Traduit en français par &quot;Enregistrer&quot;</span>
</pre></div>
</div>
<p class="last">Dans ce cas particulier, il n'est pas utile de fournir le paramètre nommé
<tt class="docutils literal"><span class="pre">default</span></tt> à la messagefactory.</p>
</div>
<p>Quelques explications :</p>
<ul class="simple">
<li>Le symbole <tt class="docutils literal"><span class="pre">_</span></tt> est un identificateur Python légal. Comme nous le verrons par
la suite, <strong class="command">i18ndude</strong> cherche dans tout le code Python de votre
composant l'utilisation de cette fonction pour élaborer les modèles de
dictionnaires (fichier <tt class="file docutils literal"><span class="pre">*.pot</span></tt>).</li>
<li><tt class="docutils literal"><span class="pre">my_message</span></tt> est le label de traduction qui figurera, après traitement par <strong class="command">i18ndude</strong>,
dans le modèle de dictionnaire <tt class="file docutils literal"><span class="pre">*.pot</span></tt> de votre composant.</li>
<li><tt class="docutils literal"><span class="pre">Some</span> <span class="pre">words</span></tt> est le texte par défaut, en anglais, du label <tt class="docutils literal"><span class="pre">my_message</span></tt>
qui sera fourni aux visiteurs du site en l'absence de traduction spécifique
pour son langage. Bien que, comme la syntaxe l'indique, le paramètre nommé
<tt class="docutils literal"><span class="pre">default</span></tt> n'est pas obligatoire (votre code ne plantera pas) son utilisation
est fortement recommandée.</li>
</ul>
<p class="rubric">Messages avec variables</p>
<p>Il est parfois nécessaire d'introduire des parties variables dans les messages à
traduire. Par exemple : &quot;Ce dossier contient 5 image(s)&quot;. Utilisez pour ceci le
paramètre nommé <tt class="docutils literal"><span class="pre">mapping</span></tt> ayant pour valeur un dictionnaire (ou objet
quelconque ayant le même protocole) fournissant <strong>toutes</strong> les clés prévues par
les emplacements réservés aux variables dans le message. Ces emplacements
variables sont marqués dans le message sous la forme <tt class="docutils literal"><span class="pre">${clé}</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="n">msg_map</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;count&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;images_in_folder&#39;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="s">u&quot;This folder has ${count} images&quot;</span><span class="p">,</span>
                <span class="n">mapping</span><span class="o">=</span><span class="n">msg_map</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="templates-zpt">
<h3>Templates ZPT<a class="headerlink" href="#templates-zpt" title="Lien permanent vers ce titre">¶</a></h3>
<p>De la même façon que le code Python, les templates ZPT peuvent être
internationalisée.</p>
<p>Le marquage d'internationalisation est effectué en utilisant l'espace de
nommage XML <tt class="docutils literal"><span class="pre">i18n</span></tt>.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span>
   <span class="na">xmlns:tal=</span><span class="s">&quot;http://xml.zope.org/namespaces/tal&quot;</span>
   <span class="na">xmlns:metal=</span><span class="s">&quot;http://xml.zope.org/namespaces/metal&quot;</span>
   <span class="na">xmlns:i18n=</span><span class="s">&quot;http://xml.zope.org/namespaces/i18n&quot;</span>
   <span class="nt">&gt;</span>
   ...
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p class="rubric">i18n:domain : Déclaration du domaine</p>
<p>Pour marquer le domaine de traduction d'une template (ou d'un élément quelconque
figurant dans une template) la déclaration préalable de ce dernier est
nécessaire dans un élément englobant.</p>
<div class="highlight-xml"><div class="highlight"><pre>...
<span class="nt">&lt;div</span> <span class="na">i18n:domain=</span><span class="s">&quot;machin&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- Les textes marqués pour traductions utiliseront les</span>
<span class="c">       messages des dictionnaires du domaine &quot;machin&quot;</span>
<span class="c">  --&gt;</span>
  ...
   <span class="nt">&lt;table</span> <span class="na">i18n:domain=</span><span class="s">&quot;truc&quot;</span><span class="nt">&gt;</span>
      <span class="c">&lt;!-- Les textes marqués de ce tableau utiliseront par</span>
<span class="c">           contre les dictionnaires du domaine &quot;truc&quot;</span>
<span class="c">      --&gt;</span>
      ...
   <span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p class="rubric">i18n:translate : Traduction du contenu d'un élément HTML</p>
<p>Le contenu de cette <tt class="docutils literal"><span class="pre">&lt;div&gt;</span></tt> sera traduit selon la clé <tt class="docutils literal"><span class="pre">label_truc</span></tt> du
domaine de traduction courant.</p>
<div class="highlight-xml"><div class="highlight"><pre>...
<span class="nt">&lt;div</span> <span class="na">i18n:translate=</span><span class="s">&quot;label_truc&quot;</span><span class="nt">&gt;</span>Some stuff<span class="nt">&lt;/div&gt;</span>
...
</pre></div>
</div>
<p>Le contenu de cette <tt class="docutils literal"><span class="pre">&lt;div&gt;</span></tt> sera traduit selon la clé <tt class="docutils literal"><span class="pre">Some</span> <span class="pre">stuff</span></tt> du
domaine de traduction courant. En effet, lorsque l'attribut <tt class="docutils literal"><span class="pre">i18n:translate</span></tt>
est vide, le contenu de la balise est utilisé comme clé de traduction.</p>
<div class="highlight-xml"><div class="highlight"><pre>...
<span class="nt">&lt;div</span> <span class="na">i18n:translate=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>Some stuff<span class="nt">&lt;/div&gt;</span>
...
</pre></div>
</div>
<p>Ceci permet de traduire des textes dont le contenu ne peut être connu qu'au
moment de la publication de la template.</p>
<div class="highlight-xml"><div class="highlight"><pre>...
<span class="c">&lt;!-- On traduit le titre lorsque c&#39;est possible --&gt;</span>
<span class="nt">&lt;span</span> <span class="na">i18n:translate=</span><span class="s">&quot;&quot;</span> <span class="na">tal:content=</span><span class="s">&quot;context/title_or_id&quot;</span><span class="nt">&gt;</span>Ze title<span class="nt">&lt;/span&gt;</span>
</pre></div>
</div>
<p class="rubric">i18n:attributes : Traduction des attributs d'un élément</p>
<p>Les attributs <tt class="docutils literal"><span class="pre">title</span></tt> et <tt class="docutils literal"><span class="pre">alt</span></tt> sont traduits selon la clé fournie par leurs
valeurs (statique ou calculée)</p>
<div class="highlight-xml"><div class="highlight"><pre>...
<span class="nt">&lt;img</span> <span class="na">title=</span><span class="s">&quot;img_title&quot;</span> <span class="na">alt=</span><span class="s">&quot;&quot;</span>
     <span class="na">tal:attributes=</span><span class="s">&quot;alt image/title&quot;</span>
     <span class="na">i18n:attributes=</span><span class="s">&quot;alt title&quot;</span> <span class="nt">/&gt;</span>
...
</pre></div>
</div>
<p class="rubric">i18n:name placer des données variables dans une traduction.</p>
<p>Il existe un système permettant de faire le mapping de messages 'à trous' dans les templates.
Reprenons notre exemple précédent : <cite>This folder has ${count} images</cite>.
Si on ne veut pas générer le message dans le code mais dans la template, on écrira :</p>
<div class="highlight-xml"><div class="highlight"><pre>...
<span class="nt">&lt;p&gt;</span>Hi<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">Utilisez tout le temps <strong>i18n:translate=&quot;&quot;</strong> dans vos templates, même si vous
appelez une fonction qui retourne un objet Message (une chaine commencant par
<tt class="docutils literal"><span class="pre">_(</span></tt> dans votre code Python). Bien que la traduction marcherait sans le
préciser avec le moteur de template d'origine, cela ne marcherait pas avec le
moteur de template alternatif Chameleon qui peut être utilisé dans Plone 4.</p>
</div>
</div>
<div class="section" id="traduire-directement-un-message">
<h3>Traduire directement un message<a class="headerlink" href="#traduire-directement-un-message" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous pouvez avoir besoin de traduire un message directement dans le code python,
si pour une raison ou une autre vous ne pouvez pas retourner un message à votre template.</p>
<p>Dans ce cas, utilisez directement l'API de traduction de zope.i18n.
Vous devez passer en paramètre la request, qui contient les informations
permettant de retrouver la langue de l'utilisateur.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">translated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;Some words&quot;</span>
        <span class="c">#message = _(u&#39;my_message&#39;, default=u&quot;Some words&quot;)</span>
        <span class="c">#return translate(message, context=self.request)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="localiser-un-composant">
<h2>Localiser un composant<a class="headerlink" href="#localiser-un-composant" title="Lien permanent vers ce titre">¶</a></h2>
<p id="index-0">Créez un environnement avec i18ndude installé :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>mkvirtualenv i18n
<span class="nv">$ </span>easy_install i18ndude
</pre></div>
</div>
<div class="admonition-attention admonition">
<p class="first admonition-title">Attention</p>
<p class="last">N'installez <strong>jamais</strong> <tt class="docutils literal"><span class="pre">i18ndude</span></tt> dans l'environnement Python standard ou
l'environnement virtuel spécifique à un projet mais bien dans un environnement
virtuel dédié.</p>
</div>
<p>Dans <tt class="file docutils literal"><span class="pre">collective/trainingmanual/i18nexamples/</span></tt> créez un script
<strong class="command">update-l10n.sh</strong> :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>i18ndude rebuild-pot --pot i18nexamples.pot --create i18nexamples ..
<span class="nv">$ </span>i18ndude sync --pot i18nexamples.pot */LC_MESSAGES/i18nexamples.po
</pre></div>
</div>
<p><strong>Le nom des fichiers po doit correspondre au domaine.</strong></p>
<p>Exécutez <tt class="docutils literal"><span class="pre">i18ndude</span> <span class="pre">-h</span></tt> pour savoir à quoi servent les différentes commandes.</p>
<p>Installez le package Ubuntu <em>gettext</em> qui contient notamment la commande <em>msginit</em>. Installez également poedit (ou kbabel) pour traduire facilement :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>sudo apt-get install gettext poedit
</pre></div>
</div>
<p>Exécutez le script <em>update-l10n.sh</em>, pour cela ajoutez le mode exécution :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>chmod u+x update-l10n.sh
<span class="nv">$ </span>./update-l10n.sh
</pre></div>
</div>
<p>La première exécution du script échouera pour les commandes <tt class="docutils literal"><span class="pre">i18ndude</span> <span class="pre">sync</span></tt> car il n'y a encore aucune traduction.</p>
<p>Pour le domaine <em>i18nexamples</em>, il vous faut tout d'abord créer le dossier dans locales :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>mkdir -p fr/LC_MESSAGES
</pre></div>
</div>
<p>Générez le fichier i18nexamples.pot avec le script :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>./update-l10n.sh
</pre></div>
</div>
<p>Ensuite créez les fichiers de traduction :</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>msginit -i i18nexamples.pot -o fr/LC_MESSAGES/i18nexamples.po
</pre></div>
</div>
<p>éditez les headers du fichier po comme ceci :</p>
<div class="highlight-po"><div class="highlight"><pre><span class="s">&quot;</span><span class="py">Language-Code:</span><span class="s"> fr\n&quot;</span>
<span class="s">&quot;</span><span class="py">Language-Name:</span><span class="s"> French\n&quot;</span>
<span class="s">&quot;</span><span class="py">Domain:</span><span class="s"> i18nexamples\n&quot;</span>
</pre></div>
</div>
<p>Traduisez ensuite avec poedit.</p>
<p>Pour que vos traductions soient prises au démarrage de l'instance, vous devez
également avoir la directive <em>i18n:registerTranslations</em> dans votre
<em>configure.zcml</em>, par exemple :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;configure</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://namespaces.zope.org/zope&quot;</span>
    <span class="na">xmlns:grok=</span><span class="s">&quot;http://namespaces.zope.org/grok&quot;</span>
    <span class="na">xmlns:i18n=</span><span class="s">&quot;http://namespaces.zope.org/i18n&quot;</span>
    <span class="na">i18n_domain=</span><span class="s">&quot;i18nexamples&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;i18n:registerTranslations</span> <span class="na">directory=</span><span class="s">&quot;locales&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;grok:grok</span> <span class="na">package=</span><span class="s">&quot;.&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="la-syntaxe-des-po-en-quelques-mots">
<h2>La syntaxe des po en quelques mots<a class="headerlink" href="#la-syntaxe-des-po-en-quelques-mots" title="Lien permanent vers ce titre">¶</a></h2>
<div class="highlight-po"><div class="highlight"><pre><span class="s">&quot;</span><span class="py">Header:</span><span class="s"> valeur du header\n&quot;</span>

<span class="kd">#: src/name.c:36</span>
<span class="nv">msgid</span> <span class="s">&quot;identifiant_du_message&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;La traduction du message&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="modifier-les-traductions-de-plone">
<h2>Modifier les traductions de Plone<a class="headerlink" href="#modifier-les-traductions-de-plone" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="creer-un-fichier-de-traduction-du-domaine-plone">
<h3>Créer un fichier de traduction du domaine plone<a class="headerlink" href="#creer-un-fichier-de-traduction-du-domaine-plone" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si vous voulez modifier des traductions de Plone pour les remplacer par vos propres messages
créez à la main dans <tt class="file docutils literal"><span class="pre">locales</span></tt> un fichier <tt class="file docutils literal"><span class="pre">plone.pot</span></tt>.</p>
<p>Ajoutez cette ligne à <tt class="file docutils literal"><span class="pre">update-l10n.sh</span></tt> :</p>
<div class="highlight-sh"><div class="highlight"><pre>i18ndude sync --pot plone.pot */LC_MESSAGES/plone.po
</pre></div>
</div>
<p>Ajoutez le fichier de traduction française avec la commande :</p>
<div class="highlight-sh"><div class="highlight"><pre>msginit -i plone.pot -o fr/LC_MESSAGES/plone.po
</pre></div>
</div>
<p>Puis éditez ce fichier pour indiquer la langue, comme vu plus haut.</p>
</div>
<div class="section" id="modifier-une-traduction-du-domaine-plone">
<h3>Modifier une traduction du domaine plone<a class="headerlink" href="#modifier-une-traduction-du-domaine-plone" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si vous voulez modifier une traduction, recherchez d'abord le msgid,
qui sera probablement dans plone.app.locales.</p>
<p>Recopiez l'entrée concernée dans le fichier plone.pot de votre package.
Le msgstr doit bien sûr être vide.</p>
<div class="highlight-po"><div class="highlight"><pre><span class="c1">#. Default: &quot;Log out&quot;</span>
<span class="kd">#: CMFPlone/profiles/default/actions.xml</span>
<span class="nv">msgid</span> <span class="s">&quot;Log out&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>
</pre></div>
</div>
<p>Relancez le script de mise à jour.</p>
<p>Vous pouvez maintenant éditer le .po de version française.
Mettez &quot;Me déconnecter&quot; (au lieu de &quot;Se...&quot;), puis redémarrez le site.</p>
</div>
</div>
<div class="section" id="mise-a-jour-des-traductions">
<h2>Mise à jour des traductions<a class="headerlink" href="#mise-a-jour-des-traductions" title="Lien permanent vers ce titre">¶</a></h2>
<p>Quand vous ajoutez des nouveaux messages dans votre composant,
allez dans le répertoire locales et relancez le script ./update-l10n.sh.</p>
<p>Les nouveaux messages du domaine i18nexamples seront ajoutés dans votre pot,
puis synchronisés dans <tt class="file docutils literal"><span class="pre">fr/LC_MESSAGES/i18nexamples.po</span></tt>.</p>
<p>Vous n'aurez plus qu'à compléter les traductions.</p>
<p>Les fichiers .po sont compilés en fichiers .mo. À chaque redémarrage du serveur,
zope détecte les .po qui ont été modifiés et les recompile.</p>
</div>
<div class="section" id="ressources">
<h2>Ressources<a class="headerlink" href="#ressources" title="Lien permanent vers ce titre">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://plone.org/documentation/how-to/product-skin-localization">http://plone.org/documentation/how-to/product-skin-localization</a></li>
<li><a class="reference external" href="http://plone.org/documentation/how-to/i18n-for-developers">http://plone.org/documentation/how-to/i18n-for-developers</a></li>
<li><a class="reference external" href="http://www.mattdorn.com/content/plone-i18n-a-brief-tutorial/">http://www.mattdorn.com/content/plone-i18n-a-brief-tutorial/</a></li>
<li><a class="reference external" href="http://maurits.vanrees.org/weblog/archive/2007/09/i18n-locales-and-plone-3.0">http://maurits.vanrees.org/weblog/archive/2007/09/i18n-locales-and-plone-3.0</a></li>
<li><a class="reference external" href="http://dev.plone.org/plone/wiki/TranslationGuidelines">http://dev.plone.org/plone/wiki/TranslationGuidelines</a></li>
<li><a class="reference external" href="http://n2.nabble.com/Recipe-for-overriding-translations-td3045492ef221724.html">http://n2.nabble.com/Recipe-for-overriding-translations-td3045492ef221724.html</a></li>
</ul>
<p>Voir <a class="reference external" href="http://dev.plone.org/plone/ticket/9090">http://dev.plone.org/plone/ticket/9090</a> pour l'état de la fusion des documents ci-dessus.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo"><a href="index.html"><img src="_static/plone-icon-64.png" />
</a></p>

  <h3><a href="index.html">Table des matières</a></h3>
  <ul>
<li><a class="reference internal" href="#">Internationalisation d'un composant</a><ul>
<li><a class="reference internal" href="#exemples-de-la-formation">Exemples de la formation</a></li>
<li><a class="reference internal" href="#internationaliser-un-composant">Internationaliser un composant</a><ul>
<li><a class="reference internal" href="#connaissances-requises">Connaissances requises</a></li>
<li><a class="reference internal" href="#notion-de-domaine">Notion de domaine</a></li>
<li><a class="reference internal" href="#code-python">Code Python</a></li>
<li><a class="reference internal" href="#templates-zpt">Templates ZPT</a></li>
<li><a class="reference internal" href="#traduire-directement-un-message">Traduire directement un message</a></li>
</ul>
</li>
<li><a class="reference internal" href="#localiser-un-composant">Localiser un composant</a></li>
<li><a class="reference internal" href="#la-syntaxe-des-po-en-quelques-mots">La syntaxe des po en quelques mots</a></li>
<li><a class="reference internal" href="#modifier-les-traductions-de-plone">Modifier les traductions de Plone</a><ul>
<li><a class="reference internal" href="#creer-un-fichier-de-traduction-du-domaine-plone">Créer un fichier de traduction du domaine plone</a></li>
<li><a class="reference internal" href="#modifier-une-traduction-du-domaine-plone">Modifier une traduction du domaine plone</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mise-a-jour-des-traductions">Mise à jour des traductions</a></li>
<li><a class="reference internal" href="#ressources">Ressources</a></li>
</ul>
</li>
</ul>

  <h4>Sujet précédent</h4>
  <p class="topless"><a href="vues_standard/plone.html"
                        title="Chapitre précédent">La vue &quot;plone&quot;</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="plonepas/index.html"
                        title="Chapitre suivant">Gestion des utilisateurs avec PlonePAS</a></p>
  <h3>Cette page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/internationalisation.txt"
           rel="nofollow">Montrer la source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Recherche rapide</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Saisissez un mot clef ou un nom de module, classe ou fonction.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="plonepas/index.html" title="Gestion des utilisateurs avec PlonePAS"
             >suivant</a> |</li>
        <li class="right" >
          <a href="vues_standard/plone.html" title="La vue &#34;plone&#34;"
             >précédent</a> |</li>
        <li><a href="index.html">Formation Plone</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010-2013, Communauté Plone francophone.
      Mis à jour le  07-February-2013.
      Créé avec <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>

<hr />
<div id="disqus_thread">
</div>
<script type="text/javascript"
        src="http://disqus.com/forums/plonepourlesintgrateurs/embed.js">
</script>
<noscript>
  <a href="http://disqus.com/forums/plonepourlesintgrateurs/?url=ref">
    View the discussion thread.
  </a>
</noscript>
<a href="http://disqus.com"
   class="dsq-brlink">blog comments powered by
  <span class="logo-disqus">Disqus</span>
</a>
<script type="text/javascript">
//<![CDATA[
(function() {
  var links = document.getElementsByTagName('a');
  var query = '?';
  for(var i = 0; i < links.length; i++) {
    if(links[i].href.indexOf('#disqus_thread') >= 0) {
      query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
    }
    // Not a Jinja end block
  }
  document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/plonepourlesintgrateurs/get_num_replies.js' + query + '"></' + 'script>');
})();
//]]>
</script>


  </body>
</html>